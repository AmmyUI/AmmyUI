<html><head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Nemerle Offline Documentation</title>
    <style type="text/css" media="screen,projection">
body {
    font: x-small sans-serif;
    background: #eee ;
    color: Black;
}
a {
    text-decoration: none;
    font-weight: bold;
    color: #25e;
    background: none;
}

a:visited { color: #63f/*#863*/; }
a:active { color: #ffa500; }
a:hover { text-decoration: underline; color: red; }

hr {
    height: 1px;
    color: #aaaaaa;
    background-color: #aaaaaa;
    border: 0;
    margin: 0.2em 0 0.2em 0;
}

h1, h2, h3, h4, h5, h6 {
    color: black;
    background: none;
    font-weight: bold;
    margin: 0;
    padding-top: 0.5em;
    padding-bottom: 0.17em;
    border-bottom: 1px solid #222;
}
h1 { font: bold 188% sans-serif; }
h2 { font: bold 150% sans-serif; }
h3 {
    border-bottom: 1px solid #aaa;
}
h4, h5, h6 {
    border-bottom: none;
}
h3 { font-size: 132%; }
h4 { font-size: 116%; }
h5 { font-size: 100%; }
h6 { font-size: 80%;  }

ul {
    line-height: 1.5em;
    list-style-type: square;
    margin: 0.3em 0 0 1.5em;
    padding:0;
}
ol {
    line-height: 1.5em;
    margin: 0.3em 0 0 3.2em;
    padding:0;
    list-style-image: none;
}
li { margin-bottom: 0.1em; }
dt {
    font-weight: bold;
    margin-bottom: 0.1em;
}
dl{
    margin-top: 0.2em;
    margin-bottom: 0.5em;
}
dd {
    line-height: 1.5em;
    margin-left: 2em;
    margin-bottom: 0.1em;
}
code { background-color: #f9f9f9; }
pre {
    padding: 1em;
    border: 1px dashed #2f6fab;
    color: Black;
    background-color: #f9f9f9;
    line-height: 1.1em;
}

#toc {
    /*border:1px solid #2f6fab;*/
    border:1px solid #aaaaaa;
    background-color:#f9f9f9;
    padding:5px;
    font-size: 95%;
    margin: 2em;
}
    </style>
  </head><body>


<a name="chunk-Tutorials_and_examples"></a>
	  	  <h1 class="firstHeading">Tutorials and examples</h1>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1"><a href="#Short_tutorials_for_writing_example_applications"><span class="tocnumber">2</span> <span class="toctext">Short tutorials for writing example applications</span></a></li>
<li class="toclevel-1"><a href="#Snippets"><span class="tocnumber">3</span> <span class="toctext">Snippets</span></a></li>
<li class="toclevel-1"><a href="#Larger_examples"><span class="tocnumber">4</span> <span class="toctext">Larger examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Sokoban_solver"><span class="tocnumber">4.1</span> <span class="toctext">Sokoban solver</span></a></li>
<li class="toclevel-2"><a href="#Nemerle_Course_programs"><span class="tocnumber">4.2</span> <span class="toctext">Nemerle Course programs</span></a></li>
<li class="toclevel-2"><a href="#ICFP.272004_Programming_Contest_entry"><span class="tocnumber">4.3</span> <span class="toctext">ICFP'2004 Programming Contest entry</span></a></li>
<li class="toclevel-2"><a href="#The_Great_Language_Shootout_Examples"><span class="tocnumber">4.4</span> <span class="toctext">The Great Language Shootout Examples</span></a></li>
<li class="toclevel-2"><a href="#ntrace"><span class="tocnumber">4.5</span> <span class="toctext">ntrace</span></a></li>
<li class="toclevel-2"><a href="#Sioux_HTTP_server"><span class="tocnumber">4.6</span> <span class="toctext">Sioux HTTP server</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#External_projects_created_using_Nemerle"><span class="tocnumber">5</span> <span class="toctext">External projects created using Nemerle</span></a>
<ul>
<li class="toclevel-2"><a href="#RiDL_-_Compiler_tools"><span class="tocnumber">5.1</span> <span class="toctext">RiDL - Compiler tools</span></a></li>
<li class="toclevel-2"><a href="#Speagram"><span class="tocnumber">5.2</span> <span class="toctext">Speagram</span></a></li>
<li class="toclevel-2"><a href="#Asper"><span class="tocnumber">5.3</span> <span class="toctext">Asper</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Introduction"></a><h2> Introduction </h2>
<p>This page lists some snippets of Nemerle code you may want to
look at. If you have any examples to be submitted here -- please
edit this page or contact us.
</p>
<a name="Short_tutorials_for_writing_example_applications"></a><h2> Short tutorials for writing example applications </h2>
<p>The tutorials gathered here are meant to be used as an easy introduction to the 
the language, by stepping through the process of writing small applications.
</p>
<ul><li><a href="#chunk-First_Tutorial" title="First Tutorial">Don't Panic! - Nemerle Basics Explained</a> -- a simple tutorial covering basic concepts of the Nemerle language.
</li><li><a href="#chunk-Second_Tutorial" title="Second Tutorial">Hashtables and foreach</a> -- presentation of how type inference makes code cleaner.
</li><li>Building a <a href="#chunk-Gtk_text_editor_%28tutorial%29" title="Gtk text editor (tutorial)">text editor using GTK#</a>.
</li><li><a href="#chunk-System.Windows.Forms_tutorial" title="System.Windows.Forms tutorial">System.Windows.Forms tutorial</a>
</li><li><a href="#chunk-Macros_tutorial" title="Macros tutorial">Macros tutorial</a> -- the basics of meta-programming in Nemerle.
</li><li>Using <a href="#chunk-ASP.NET_%28tutorial%29" title="ASP.NET (tutorial)">ASP.NET</a> with Nemerle.
</li><li><a href="#chunk-Remoting_%28tutorial%29" title="Remoting (tutorial)">Remoting</a> -- presents a technique of accessing remote objects on the server.
</li><li><a href="#chunk-PInvoke_%28tutorial%29" title="PInvoke (tutorial)">PInvoking</a> -- gives insight on how to use native (unmanaged) libraries from Nemerle.
</li></ul>
<p>There is also <a href="http://wiki.nemerle.org/Grokking_Nemerle" title="Grokking Nemerle">Grokking Nemerle</a> -- a "book" covering most of the language.
</p>
<a name="Snippets"></a><h2> Snippets </h2>
<p>You can find various examples of Nemerle code in <a href="http://nemerle.org/svn/nemerle/trunk/snippets/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/">snippets</a>
directory in Nemerle source tree. You are welcomed to transform them into tutorials. Examples include:
</p>
<ul><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/lcs.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/lcs.n">lcs.n</a> -- short program computing the longest common substring
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/sql.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sql.n">sql.n</a> -- an example of database connectivity using Nemerle macros
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/suffix.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/suffix.n">suffix.n</a> -- suffix trees
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/ncc/testsuite/positive/form.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/ncc/testsuite/positive/form.n">form.n</a> -- a Windows.Forms example
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/myPoll.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/myPoll.n">myPoll.n</a> -- an example of a CGI application connecting to a PostgreSQL database
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/power-race.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/power-race.n">power-race.n</a> -- a ncurses-based "game". <a href="http://nemerle.org/images/power-race.png" class="external text" title="http://nemerle.org/images/power-race.png">Screenshot</a>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/boyer-moore.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/boyer-moore.n">boyer-moore.n</a> -- a Boyer-Moore algorithm
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/knuth-morris-pratt.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/knuth-morris-pratt.n">knuth-morris-pratt.n</a> -- a Knuth-Morris-Pratt algorithm
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/nondec-subseq.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/nondec-subseq.n">nondec-subseq.n</a> -- the longest non-decreasing subsequence
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/rachunki.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/rachunki.n">rachunki.n</a> -- a billing generator for a conference
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/shift-or.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/shift-or.n">shift-or.n</a> -- a shift-or text searching algorithm
</li></ul>
<p>These are also bundled with the source distribution.
</p>
<a name="Larger_examples"></a><h2> Larger examples </h2>
<p>There are also several more advanced examples there:
</p>
<a name="Sokoban_solver"></a><h3> Sokoban solver </h3>
<p><a href="http://nemerle.org/svn/nemerle/trunk/snippets/sokoban/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sokoban/">Sokoban</a> -- Sokoban solver by Bartosz Podlejski
</p>
<a name="Nemerle_Course_programs"></a><h3> Nemerle Course programs </h3>
<p>Examples done by students during the Nemerle course at the CS Institute in the Wroclaw University.
</p>
<ul><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/ERA-SMS-Sender" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/ERA-SMS-Sender">ERA-SMS-Sender</a> -- allows sending an SMS to a Polish GSM provider ERA (uses a POP3 client). By <b>Adrian Macal</b> <i>mel_on0 at o2 dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/backup-tool.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/backup-tool.n">backup-tool.n</a> -- a program for performing backups, using simple scripts. By <b>Ryszard Trojnacki</b> <i>rysiek at menel dot com</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/freedb.org-client/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/freedb.org-client/">freedb.org client</a> -- a simple program to download information from <a href="http://freedb.org/" class="external text" title="http://freedb.org/">freedb.org</a> database for an audio CD currently in the drive under Linux. By <b>Wojtek Knapik</b> <i>d at hell dot art dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/swf-calculator.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/swf-calculator.n">swf-calculator.n</a> -- a simple calculator using System.Windows.Forms. By <b>Marek Czajka</b> <i>marek_czajka at wp dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/huffman/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/huffman/">huffman</a> -- huffman compression and decompression. By <b>Ania Dwojak</b> <i>andzia200 at wp dot pl</i>. 
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/getmxbyname.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/getmxbyname.n">getmxbyname.n</a> -- a class to find out the MX record for a domain. By <b>Marcin Skórzewski</b> <i>pirol at o2 dot pl</i>.
</li></ul>
<a name="ICFP.272004_Programming_Contest_entry"></a><h3> ICFP'2004 Programming Contest entry </h3>
<p>In June 2004 there was a <a href="http://www.cis.upenn.edu/proj/plclub/contest/ants.html" class="external text" title="http://www.cis.upenn.edu/proj/plclub/contest/ants.html">contest</a> to create finite state automata controlling the ants. Our entry is now available <a href="http://nemerle.org/svn/nemerle/trunk/snippets/ants-icfp2004/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/ants-icfp2004/">here</a>.
</p><p>This year's contest page of our team is located here <a href="http://wiki.nemerle.org/ICFPC2005" title="ICFPC2005">ICFPC2005</a>.
</p>
<a name="The_Great_Language_Shootout_Examples"></a><h3> The Great Language Shootout Examples </h3>
<p><a href="http://nemerle.org/svn/nemerle/trunk/snippets/shootout/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/shootout/">These</a> are the few examples ported from the <a href="http://dada.perl.it/shootout/" class="external text" title="http://dada.perl.it/shootout/">Win32 Computer Language Shootout</a>.
We didn't submit them yet, looking for volunteers to port more. When we
have enough examples, we will also send them to the recently linked <a href="http://shootout.alioth.debian.org/" class="external text" title="http://shootout.alioth.debian.org/">renewed shootout</a>.
</p>
<a name="ntrace"></a><h3> ntrace </h3>
<p>This <a href="http://nemerle.org/svn/nemerle/trunk/snippets/ntrace/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/ntrace/">simple program</a> will trace memory leaks in programs written in C. By Jacek Śliwerski.
</p>
<a name="Sioux_HTTP_server"></a><h3> Sioux HTTP server </h3>
<p>A <a href="http://nemerle.org/svn/nemerle/trunk/snippets/sioux/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sioux/">simplistic HTTP server</a>.
The main idea behind it is to serve web applications written in
Nemerle. It already served as a subscription server for the XVIII-th
FIT (a local conference) and later for the <a href="http://csl04.ii.uni.wroc.pl/" class="external text" title="http://csl04.ii.uni.wroc.pl/">CSL 2004</a>.
</p>
<a name="External_projects_created_using_Nemerle"></a><h2> External projects created using Nemerle </h2>
<a name="RiDL_-_Compiler_tools"></a><h3> RiDL - Compiler tools </h3>
<p><a href="http://sourceforge.net/projects/ridl/" class="external text" title="http://sourceforge.net/projects/ridl/">RiDL</a>
is a set of tools to simplify building compilers using Nemerle. It
includes a lexical analyzer generator and a parser generator.
</p><p>It is created by <a href="http://sourceforge.net/users/samanpa/" class="external text" title="http://sourceforge.net/users/samanpa/">Kojo Adams</a> and uses <a href="http://sourceforge.net/softwaremap/trove_list.php?form_cat=187" class="external text" title="http://sourceforge.net/softwaremap/trove list.php?form cat=187">BSD Licence</a>.
</p>
<a name="Speagram"></a><h3> Speagram </h3>
<p><a href="http://www.speagram.org/index.html" class="external text" title="http://www.speagram.org/index.html">Speagram</a> is an eager purely functional language with a strong type system and unusual syntax resembling natural language.
</p>
<a name="Asper"></a><h3> Asper </h3>
<p><a href="https://opensvn.csie.org/traccgi/asper/trac.cgi" class="external text" title="https://opensvn.csie.org/traccgi/asper/trac.cgi">Asper</a> is a text editor and IDE for Nemerle written in Nemerle.
</p>
<!-- Saved in parser cache with key wiki:pcache:idhash:968-0!1!0!0!!en!2 and timestamp 20060120213518 -->
<a name="chunk-First_Tutorial"></a>
	  	  <h1 class="firstHeading">First Tutorial</h1>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2"><a href="#Nemerle.2C_.NET.2C_and_Mono"><span class="tocnumber">1.1</span> <span class="toctext">Nemerle, .NET, and Mono</span></a></li>
<li class="toclevel-2"><a href="#Getting_Started"><span class="tocnumber">1.2</span> <span class="toctext">Getting Started</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Simple_Examples"><span class="tocnumber">2</span> <span class="toctext">Simple Examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Hello_World"><span class="tocnumber">2.1</span> <span class="toctext">Hello World</span></a>
<ul>
<li class="toclevel-3"><a href="#Classes:_a_First_Look"><span class="tocnumber">2.1.1</span> <span class="toctext">Classes: a First Look</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#The_Adder"><span class="tocnumber">2.2</span> <span class="toctext">The Adder</span></a></li>
<li class="toclevel-2"><a href="#Counting_Lines_in_a_File"><span class="tocnumber">2.3</span> <span class="toctext">Counting Lines in a File</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Functional_examples"><span class="tocnumber">3</span> <span class="toctext">Functional examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Functional_Programming:_a_First_Look"><span class="tocnumber">3.1</span> <span class="toctext">Functional Programming: a First Look</span></a></li>
<li class="toclevel-2"><a href="#Rewriting_Line_Counter_without_the_loop"><span class="tocnumber">3.2</span> <span class="toctext">Rewriting Line Counter without the loop</span></a></li>
<li class="toclevel-2"><a href="#Rewriting_line_counter_without_mutable_values"><span class="tocnumber">3.3</span> <span class="toctext">Rewriting line counter without mutable values</span></a></li>
<li class="toclevel-2"><a href="#Type_inference"><span class="tocnumber">3.4</span> <span class="toctext">Type inference</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#More_info"><span class="tocnumber">4</span> <span class="toctext">More info</span></a></li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Introduction"></a><h2> Introduction </h2>
<p>This tutorial describes the basics of programming in Nemerle. It is also a 
quick tour of some of the features and programming concepts that distinguish Nemerle 
from other languages.
</p><p>We assume the reader is familiar with C#, Java or C++. But even if you are new to 
programming, you should find the code easy to understand.
</p>
<a name="Nemerle.2C_.NET.2C_and_Mono"></a><h3> Nemerle, .NET, and Mono </h3>
<p>Nemerle is a <span title="Say ‘dot-NET’" style="border-bottom: 1px dotted;"><i>.NET</i></span> 
compatible language. As such, it relies heavily on the 
<a href="http://msdn.microsoft.com/netframework/programming/" class="external text" title="http://msdn.microsoft.com/netframework/programming/">.NET Framework</a>, 
which not only defines how critical parts of all .NET languages work, 
but also provides these services:
</p>
<ul><li> A runtime environment, called the Common Language Runtime
(CLR), which is shared among all .NET languages. This is similar to the
Java VM </li><li> A set of libraries, called the Base Class Libraries (BCL),
which contain thousands of functions that perform a wide range of
services required by programs </li></ul>
<p>The BCL and CLR ensure that programs written in any .NET language can be 
easily used in any other .NET language. These features of language neutrality 
and interoperability make .NET an attractive platform for development.
</p><p>Further, Nemerle is compatible with <a href="http://www.mono-project.com/Main_Page" class="external text" title="http://www.mono-project.com/Main Page">Mono</a>, 
an open-source implementation of the published .NET <i>Common Language Infrastructure (CLI)</i> 
standard. This opens up the exciting possibility of writing .NET programs 
that not only work across different languages, but span different 
operating systems. With Mono, you can design programs that run on Linux, 
Mac&nbsp;OS&nbsp;X, and the BSD&nbsp;Unix flavors, as well as Windows.
</p><p>So, while Nemerle is defined (and constrained) in part by the .NET Framework, 
it is very much its own language. It offers a unique combination of features 
not found in other .NET languages, which give it advantages of conciseness and 
flexibility that should prove attractive to a wide range of programmers, from 
students to seasoned developers.
</p>
<a name="Getting_Started"></a><h3> Getting Started </h3>
<p>To run the examples in this tutorial, you will need to <a href="http://wiki.nemerle.org/Download" title="Step by step guide to get Nemerle compiler running">install Nemerle</a>. Hacker types will want to <replace_me_please title="Download">download the source.
</replace_me_please></p>
<a name="Simple_Examples"></a><h2> Simple Examples </h2> 
<p>This section lists simple examples that look almost the same in C#
(or Java, or C++).
</p>
<a name="Hello_World"></a><h3> Hello World </h3>
<p>We start with a classic first example:
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Hello world!"</span><span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>To run this example:
</p>
<ul><li> Write it with your favorite text editor and save it as <tt>hello.n</tt>
</li><li> Get to the console by running cmd in Windows, or the terminal window in Linux/BSD
</li><li> Run the Nemerle compiler by typing <tt>ncc hello.n</tt>
</li><li> The output goes to <tt>out.exe</tt>
</li><li> Run it by typing <tt>out</tt> or <tt>mono out.exe</tt> depending on your OS 
</li></ul>
<p>Observe how an individual code statement ends with a semi-colon<tt>;</tt>
</p><p>This program writes "Hello world!" to the console. It does this by calling <tt>System.Console.WriteLine</tt>, a function in the .NET Framework. 
</p><p>As this example shows, you can write a bunch of statements in a
file (separated by semi-colons), and Nemerle will execute them.
However, this example really isn't a proper, stand-alone program. To
make it one, you need to wrap it in a class.
</p>
<a name="Classes:_a_First_Look"></a><h4>Classes: a First Look</h4> 
<p>Lets expand our example to include a class. Enter these lines in your <tt>hello.n</tt> file: 
</p>
<pre class="nemerle"> <span style="color: rgb(255, 0, 0);">class</span> Hello
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Hello world!"</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Notice how blocks of code are grouped together using curly braces <tt>{&nbsp;}</tt>, typical of C-style programs.
</p><p>When you compile and run this program, you get the same results
as before. So why the extra lines? The answer is that Nemerle, like
most .NET languages, is object-oriented:
</p>
<ul><li> <tt>class Hello</tt> simply means that you are defining a <i>class</i>, or type of object, named <tt>Hello</tt>. A class is a template for making objects. Classes can be used standalone, too, as is the case here.
</li><li> <tt>static Main</tt> defines a function <tt>Main</tt>, which belongs to class <tt>Hello</tt>. A function that belongs to a class is called a <i>method</i> of the class. So, here you would say "function <tt>Main</tt> is a method of class <tt>Hello</tt>." 
</li><li> By convention, program execution starts at <tt>static Main</tt>. The keyword <tt>static</tt> means the method can be called directly, without first creating an object of type <tt>Hello</tt>. Static methods are the equivalent of public or module-level functions in non-object languages.
</li></ul>
<p>This example is much closer to what a C# programmer would write. The
only difference is that in Nemerle we write the method's return type on
the right, after the colon. So, <tt>static&nbsp;Main():void</tt> specifies that method <tt>Main</tt> returns <tt>void</tt>, or no usable type. This is the equivalent of a subroutine in Basic.
</p>
<a name="The_Adder"></a><h3> The Adder </h3>
<p>Adder is a very simple program that reads and adds two numbers. We will 
refine this program by introducing several Nemerle concepts. 
</p><p>To start, enter and compile this code:
</p>
<pre class="nemerle"> <span style="color: rgb(0, 128, 128); font-style: italic;">/*  Our second example.  
    This is a comment. */</span> 
&nbsp;
 <span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
&nbsp;
 <span style="color: rgb(0, 128, 128); font-style: italic;">//  This is also a comment</span>
 
 <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> Adder      <span style="color: rgb(0, 128, 128); font-style: italic;">//  As in C#, we can mark classes public.</span>
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>         <span style="color: rgb(0, 128, 128); font-style: italic;">//  Methods, too.</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(0, 128, 128); font-style: italic;">/*  Read two lines, convert them to integers and return their
       sum. */</span> 
     Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"The sum is {0}"</span>,
                        <span style="color: rgb(0, 128, 128); font-style: italic;">//  System.Int32.Parse converts string into integer.</span>
                        Int32.Parse <span style="color: rgb(0, 0, 0);">(</span>Console.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span> +
                        Int32.Parse <span style="color: rgb(0, 0, 0);">(</span>Console.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>When run, Adder lets you type in two numbers from the console, then prints out the sum.
</p><p>As you can see, a lengthy statement can be continued on multiple lines, and mixed with 
comments, as long as it ends with a semi-colon<tt>;</tt>
</p><p>The <tt>using</tt> declaration imports identifiers from the specified namespace, so they 
can be used without a prefix. This improves readability and saves typing. Unlike C#, 
Nemerle can also import members from classes, not only from namespaces. For example:
</p>
<pre class="nemerle"> <span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
 <span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Console;
&nbsp;
 <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> Adder
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"The sum is {0}"</span>,
                Int32.Parse <span style="color: rgb(0, 0, 0);">(</span>ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span> +
                Int32.Parse <span style="color: rgb(0, 0, 0);">(</span>ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>You probably noticed that the code that reads and converts the integers 
is needlessly duplicated. We can simplify and clarify this code by 
factoring it into it's own method:
</p>
<pre class="nemerle"> <span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
&nbsp;
 <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> Adder
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(0, 128, 128); font-style: italic;">//  Methods are private by default.</span>
   <span style="color: rgb(6, 0, 255);">static</span> ReadInteger <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     Int32.Parse <span style="color: rgb(0, 0, 0);">(</span>Console.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(6, 0, 255);">def</span> x = ReadInteger <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">//  Value definition.</span>
     <span style="color: rgb(6, 0, 255);">def</span> y = ReadInteger <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(0, 128, 128); font-style: italic;">//  Use standard .NET function for formatting output.</span>
     Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"{0} + {1} = {2}"</span>, x, y, x + y<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Within the <tt>Main</tt> method we have defined two <i>values</i>, <tt>x</tt> 
and <tt>y</tt>. This is done using the <tt>def</tt> keyword. Note that we do 
not write the value type when it is defined. The compiler sees that 
<tt>ReadInteger</tt> returns an <tt>int</tt>, so therefore the type of 
<tt>x</tt> must also be <tt>int</tt>. This is called <i>type inference</i>.
</p><p>There is more to <tt>def</tt> than just declaring values: it also has an 
impact on how the value can be used, as we shall see in the next section.
</p><p>In this example we see no gain from using <tt>def</tt> instead of <tt>int</tt> as 
you would do in C# (both are 3 characters long&nbsp;:-). However <tt>def</tt> will save 
typing, because in most cases type names are far longer:
</p>
<pre class="nemerle">FooBarQuxxFactory fact = <span style="color: rgb(0, 128, 0);">new</span> FooBarQuxxFactory <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">// C#</span>
<span style="color: rgb(6, 0, 255);">def</span> fact = FooBarQuxxFactory <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">// Nemerle</span></pre>
<p>When creating objects, Nemerle does not use the <tt>new</tt> keyword. This aligns 
nicely with the .NET concept that all types, even simple ones like <tt>int</tt> 
and <tt>bool</tt>, are objects. That being said, simple types are a special 
kind of object, and are treated differently during execution than regular objects.
</p>
<a name="Counting_Lines_in_a_File"></a><h3> Counting Lines in a File </h3>
<pre class="nemerle"> <span style="color: rgb(255, 0, 0);">class</span> LineCounter
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(0, 128, 128); font-style: italic;">//  Open a file.</span>
     <span style="color: rgb(6, 0, 255);">def</span> sr = <span style="color: rgb(0, 0, 0);">System</span>.IO.StreamReader <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"SomeFile.txt"</span><span style="color: rgb(0, 0, 0);">)</span>;   <span style="color: rgb(0, 128, 128); font-style: italic;">//  (1)</span>
     <span style="color: rgb(6, 0, 255);">mutable</span> line_no = <span style="color: rgb(255, 0, 0);">0</span>;                                <span style="color: rgb(0, 128, 128); font-style: italic;">//  (2)</span>
     <span style="color: rgb(6, 0, 255);">mutable</span> line = sr.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(6, 0, 255);">while</span> <span style="color: rgb(0, 0, 0);">(</span>line&nbsp;!= <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>              <span style="color: rgb(0, 128, 128); font-style: italic;">//  (3)</span>
       <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span>line<span style="color: rgb(0, 0, 0);">)</span>;
       line_no = line_no + <span style="color: rgb(255, 0, 0);">1</span>;            <span style="color: rgb(0, 128, 128); font-style: italic;">//  (4)</span>
       line = sr.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(0, 0, 0);">}</span>;                                  <span style="color: rgb(0, 128, 128); font-style: italic;">//  (5)</span>
     <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Line count: {0}"</span>, line_no<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Several things things about this example require further remarks. The first 
is the very important difference between the lines marked (1) and (2).
</p><p>In line (1) we define an <i>immutable</i> variable, <tt>sr</tt>. Immutable means the 
value cannot be changed once it is defined. The <tt>def</tt> statement is used to 
mark this intent. This concept may at first seem odd, but quite often you will find 
the need for variables that don't change over their lifetime. 
</p><p>In (2) we define a <i>mutable</i> variable, <tt>line_no</tt>. Mutable values are 
allowed to change freely, and are defined using the <tt>mutable</tt> statement. 
This is the Nemerle equivalent of a variable in C#. All variables, mutable or 
not, have to be initialized before use. 
</p><p>In (3) we see a <tt>while</tt> loop. While the line is not null (end of file), 
this loop writes the line to the console, counts it, and reads the next. It works 
much like it would in C#. Nemerle also has <tt>do ... while</tt> loops.
</p><p>We see our mutable counter getting incremented in (4). The assignment operator 
in Nemerle is <tt>=</tt>, and is similar to C#.
</p><p>Lastly, in (5), we come to the end of of our while loop code block. The line count 
gets written after the while loop exits.
</p>
<a name="Functional_examples"></a><h2> Functional examples </h2>
<p>This section introduces some of the more functional features of Nemerle. 
We will use the functional style to write some simple programs, that could 
easily be written in the more familiar imperative style, to introduce a few 
concepts of the functional approach.
</p>
<a name="Functional_Programming:_a_First_Look"></a><h4> Functional Programming: a First Look </h4>
<p>Functional programming (FP) is style in which you do not modify the state
of the machine with instructions, but rather evaluate functions yielding
newer and newer values. That is, the entire program is just one big expression. In
purely functional languages (Haskell being the main example) you cannot modify
any objects once they are created (there is no assignment operator, like = 
in Nemerle). There are no loops, just <i>recursive functions</i>. A recursive function 
calls itself repeatedly until some end condition is met, at which time 
it returns its result.
</p><p>Nemerle does not force you to use FP. However you can use it whenever
you find it necessary. Some algorithms have a very natural representation
when written in functional style -- for example functional languages
are very good at manipulating tree-like data structures (like XML,
in fact XSLT can be thought of as a functional language).
</p><p>We will be using the terms <i>method</i> and <i>function</i> interchangeably.
</p>
<a name="Rewriting_Line_Counter_without_the_loop"></a><h3> Rewriting Line Counter without the loop </h3>
<p>Let's rewrite our previous Line Counter example using a recursive
function instead of the loop. It will get longer, but that will get
fixed soon.
</p>
<pre class="nemerle"> <span style="color: rgb(255, 0, 0);">class</span> LineCounterWithoutLoop
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(6, 0, 255);">def</span> sr = <span style="color: rgb(0, 0, 0);">System</span>.IO.StreamReader <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"SomeFile.txt"</span><span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(6, 0, 255);">mutable</span> line_no = <span style="color: rgb(255, 0, 0);">0</span>;
&nbsp;
     <span style="color: rgb(6, 0, 255);">def</span> read_lines <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>            <span style="color: rgb(0, 128, 128); font-style: italic;">//  (1)</span>
       <span style="color: rgb(6, 0, 255);">def</span> line = sr.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
       <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>line&nbsp;!= <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>               <span style="color: rgb(0, 128, 128); font-style: italic;">//  (2)</span>
         <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span>line<span style="color: rgb(0, 0, 0);">)</span>;  <span style="color: rgb(0, 128, 128); font-style: italic;">//  (3)</span>
         line_no = line_no + <span style="color: rgb(255, 0, 0);">1</span>;            <span style="color: rgb(0, 128, 128); font-style: italic;">//  (4)</span>
         read_lines <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>                     <span style="color: rgb(0, 128, 128); font-style: italic;">//  (5)</span>
       <span style="color: rgb(0, 0, 0);">}</span>
     <span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
     read_lines <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;      <span style="color: rgb(0, 128, 128); font-style: italic;">//  (6)</span>
 
     <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Line count: {0}"</span>, line_no<span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">//  (7)</span>
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>In (1) we define a <i>nested method</i> called <tt>read_lines</tt>. This method 
simulates the <tt>while</tt> loop used in our previous example. It takes no 
parameters and returns a void value.
</p><p>(2) If line wasn't <tt>null</tt> (i.e. it was not the last line), (3) we write
the line we just read, (4) increase the line number, and finally (5) call
ourself to read rest of the lines. The when expression is explained below.
</p><p>Next (6) we call <tt>read_lines</tt> for the first time, and finally (7) print
the line count.
</p><p>The <tt>read_lines</tt> will get called as many times as there are
lines in the file. As you can see this is the same as the <tt>while</tt> loop,
just expressed in a slightly different way. It is very important to
grok this concept of writing loops as recursion, in order to program
functionally in Nemerle.
</p><p>If you are concerned about performance of this form of writing loops --
fear not. When a function body ends with call to another function 
no new stack frame is created. It is called a <b>tail call</b>. Thanks
to it the example above is as efficient as the <tt>while</tt> loop we
saw before.
</p><p>In Nemerle the if expression always need to have the else clause. It's
done this way to avoid stupid bugs with dangling-else:
</p>
<pre class="csharp"><span style="color: rgb(0, 128, 128); font-style: italic;">// C#, misleading indentation hides real code meaning</span>
<span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>foo<span style="color: rgb(0, 0, 0);">)</span>
   <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>bar<span style="color: rgb(0, 0, 0);">)</span>
     m1 <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(6, 0, 255);">else</span>
   m2 <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>If you do not want the <tt>else</tt> clause, use <tt>when</tt> expression,
as seen in the example. There is also <tt>unless</tt> expression, equivalent 
to <tt>when</tt> with the condition negated.
</p>
<a name="Rewriting_line_counter_without_mutable_values"></a><h3> Rewriting line counter without mutable values </h3>
<p>Our previous aim of rewriting line counter removed the loop and one
mutable value. However one mutable value has left, so we cannot say the
example is written functionally. We will now kill it.
</p>
<pre class="nemerle"> <span style="color: rgb(255, 0, 0);">class</span> FunctionalLineCounter
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(6, 0, 255);">def</span> sr = <span style="color: rgb(0, 0, 0);">System</span>.IO.StreamReader <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"SomeFile.txt"</span><span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(6, 0, 255);">def</span> read_lines <span style="color: rgb(0, 0, 0);">(</span>line_no&nbsp;: <span style="color: rgb(255, 0, 0);">int</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">int</span> <span style="color: rgb(0, 0, 0);">{</span>   <span style="color: rgb(0, 128, 128); font-style: italic;">//  (1)</span>
       <span style="color: rgb(6, 0, 255);">def</span> line = sr.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
       <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>line == <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span>      <span style="color: rgb(0, 128, 128); font-style: italic;">//  (2)</span>
         line_no              <span style="color: rgb(0, 128, 128); font-style: italic;">//  (3)</span>
       <span style="color: rgb(6, 0, 255);">else</span> <span style="color: rgb(0, 0, 0);">{</span>
         <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span>line<span style="color: rgb(0, 0, 0);">)</span>;  <span style="color: rgb(0, 128, 128); font-style: italic;">//  (4)</span>
         read_lines <span style="color: rgb(0, 0, 0);">(</span>line_no + <span style="color: rgb(255, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">)</span>          <span style="color: rgb(0, 128, 128); font-style: italic;">//  (5)</span>
       <span style="color: rgb(0, 0, 0);">}</span>
     <span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
     <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Line count: {0}"</span>, read_lines <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">//  (6)</span>
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>In (1) we again define a nested method called <tt>read_lines</tt>. However
this time it takes one integer parameter -- the current line number. It
returns the number of lines in the entire file.
</p><p>(2) If line we just read is null (that was last line), we (3) return
the current line number as number of lines in entire file. As you can
see <b>there is no return statement</b>. The return value of a method is its
last expression.
</p><p>(4) Otherwise (it was not last line) we write the line we just
read. Next (5) we call ourselves to read the next line. We need to
increase the line number, since it is the next line that we will be
reading. Note that as a return value from this invocation of <tt>read_lines</tt> we return what the next invocation of <tt>read_lines</tt>
returned. It in turn returns what the next invocation returned and so
on, until, at the end of file, we reach (3), and final line count is
returned through each invocation of <tt>read_lines</tt>.
</p><p>In (6) we call the <tt>read_lines</tt> nested method, with initial line
number of 0 to read the file and print out line count.
</p>
<a name="Type_inference"></a><h3> Type inference </h3>
<p>We have already seen type inference used to guess types of values
defined with <tt>def</tt> or <tt>mutable</tt>. It can be also used to
guess type of function parameters and return type. Try removing the&nbsp;:
int constraints from line marked (1) in our previous example.
</p><p>Type inference only works for nested functions. Type annotations are
required in top-level methods (that is methods defined in classes, not
in other methods). This is design decision, that is here not to change
external interfaces by accident.
</p><p>It is sometimes quite hard to tell the type of parameter, from just
looking how it is used. For example consider:
</p>
<pre class="nemerle"> <span style="color: rgb(255, 0, 0);">class</span> HarderInference
 <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">int</span> <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(6, 0, 255);">def</span> f <span style="color: rgb(0, 0, 0);">(</span>x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
       x.Length
     <span style="color: rgb(0, 0, 0);">}</span>;
     f <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"foo"</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
 <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>When compiling the f method we cannot tell if x is a string or array
or something else. Nevertheless, we can tell it later (looking at f
invocation) and Nemerle type inference engine does it.
</p><p>If function with incomplete type information was not used or its type
was ambiguous, compiler would refuse to compile it.
</p>
<a name="More_info"></a><h2> More info </h2>
<p>Now, once you read through all this, please move to the <a href="http://wiki.nemerle.org/Grokking_Nemerle" title="Grokking Nemerle">Grokking Nemerle</a>
tutorial, that is much more complete. You can also have a look at 
<a href="http://wiki.nemerle.org/Reference" title="Reference">The Reference Manual</a> if you are tough.
</p>
<!-- Saved in parser cache with key wiki:pcache:idhash:983-0!1!0!0!!en!2 and timestamp 20060120224156 -->
<a name="chunk-Second_Tutorial"></a>
	  	  <h1 class="firstHeading">Second Tutorial</h1>
	    	    	    <!-- start content -->
	    <p>We will write some example code, so you can see some common code patterns when writing programs in Nemerle.
</p>
<a name="Small_app_with_array_and_Hashtable"></a><h2> Small app with array and Hashtable </h2>
<p>Let us create an array and print its elements walking through it in loop.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Console;
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> MyApp
<span style="color: rgb(0, 0, 0);">{</span>
   Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(0, 128, 128); font-style: italic;">// create an array containing strings (array [string])</span>
     <span style="color: rgb(6, 0, 255);">def</span> elements = <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(128, 128, 128);">"{0}"</span>, <span style="color: rgb(128, 128, 128);">"a {0} a"</span>, <span style="color: rgb(128, 128, 128);">"{0}"</span>, <span style="color: rgb(128, 128, 128);">"b {0}"</span>, <span style="color: rgb(128, 128, 128);">"b {0}"</span><span style="color: rgb(0, 0, 0);">]</span>;
&nbsp;
     <span style="color: rgb(0, 128, 128); font-style: italic;">// iterate through elements of array</span>
     <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> i = <span style="color: rgb(255, 0, 0);">0</span>; i &lt; elements.Length; i++<span style="color: rgb(0, 0, 0);">)</span>
       <span style="color: rgb(0, 128, 128); font-style: italic;">// print current value of `i' with using format from array</span>
       WriteLine <span style="color: rgb(0, 0, 0);">(</span>elements <span style="color: rgb(0, 0, 0);">[</span>i<span style="color: rgb(0, 0, 0);">]</span>, i<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>The keys stored in <i>elements</i> array looks a little bit strange, but we will use <i>WriteLine</i> 
method as a good example of processing key together with value associated to it.
</p>
<a name="Counting_unique_elements"></a><h3> Counting unique elements </h3>
<p>We will now make the collection of keys unique. For this purpose we
will use generic dictionary type, which in Nemerle is called <i>Nemerle.Collections.Hashtable</i>.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Collections;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Console;
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> MyApp
<span style="color: rgb(0, 0, 0);">{</span>
   Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     <span style="color: rgb(0, 128, 128); font-style: italic;">// create an array containing strings (array [string])</span>
     <span style="color: rgb(6, 0, 255);">def</span> elements = <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(128, 128, 128);">"{0}"</span>, <span style="color: rgb(128, 128, 128);">"a {0} a"</span>, <span style="color: rgb(128, 128, 128);">"{0}"</span>, <span style="color: rgb(128, 128, 128);">"b {0}"</span>, <span style="color: rgb(128, 128, 128);">"b {0}"</span><span style="color: rgb(0, 0, 0);">]</span>;
&nbsp;
     <span style="color: rgb(6, 0, 255);">def</span> hash = Hashtable <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
     <span style="color: rgb(0, 128, 128); font-style: italic;">// count the number of occurrences of each unique element</span>
     <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>e <span style="color: rgb(6, 0, 255);">in</span> elements<span style="color: rgb(0, 0, 0);">)</span>
     <span style="color: rgb(0, 0, 0);">{</span>
       <span style="color: rgb(6, 0, 255);">unless</span> <span style="color: rgb(0, 0, 0);">(</span>hash.Contains <span style="color: rgb(0, 0, 0);">(</span>e<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>
         hash<span style="color: rgb(0, 0, 0);">[</span>e<span style="color: rgb(0, 0, 0);">]</span> = <span style="color: rgb(255, 0, 0);">0</span>;
         
       hash<span style="color: rgb(0, 0, 0);">[</span>e<span style="color: rgb(0, 0, 0);">]</span> += <span style="color: rgb(255, 0, 0);">1</span>;
     <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
     <span style="color: rgb(0, 128, 128); font-style: italic;">// print each element with number indicating its total count</span>
     <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>keypair <span style="color: rgb(6, 0, 255);">in</span> hash<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
       WriteLine <span style="color: rgb(0, 0, 0);">(</span>keypair.Key, keypair.Value<span style="color: rgb(0, 0, 0);">)</span>;
     <span style="color: rgb(0, 0, 0);">}</span>
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>For each entry in hashtable we store the number of how many times it occured.
</p>
<a name="What_about_functional_programming.3F"></a><h3> What about functional programming? </h3>
<p>Ok, iterating over collection with <i>foreach</i> is nice, but it is still *too long*!
</p>
<pre class="nemerle"><span style="color: rgb(0, 128, 128); font-style: italic;">// print each element with number indicating its total count</span>
<span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>keypair <span style="color: rgb(6, 0, 255);">in</span> hash<span style="color: rgb(0, 0, 0);">)</span>
  WriteLine <span style="color: rgb(0, 0, 0);">(</span>keypair.Key, keypair.Value<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
<span style="color: rgb(0, 128, 128); font-style: italic;">// pass matching overload of WriteLine to iteration method</span>
hash.Iter <span style="color: rgb(0, 0, 0);">(</span>WriteLine<span style="color: rgb(0, 0, 0);">)</span></pre>
<p><i>Hashtable</i> have the special <i>Iter</i> overload, which takes a generic two-argument function, 
which will be called for every element stored in collection. The declaration of <i>Iter</i> looks like this:
</p>
<pre class="nemerle"><span style="color: rgb(255, 0, 0);">class</span> Hashtable <span style="color: rgb(0, 0, 0);">[</span>'a, 'b<span style="color: rgb(0, 0, 0);">]</span> 
<span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> Iter <span style="color: rgb(0, 0, 0);">(</span>f&nbsp;: 'a * 'b -&gt; <span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> 
   <span style="color: rgb(0, 0, 0);">{</span> ... <span style="color: rgb(0, 0, 0);">}</span>
...
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>and after substituting <i> 'a </i> and <i> 'b </i> with actual types in our <i>hash</i>, we just use 
it as <tt>Iter&nbsp;: (string * int -&gt; void) -&gt; void</tt>, which takes <tt>string * int -&gt; void</tt> function as 
the only argument.
</p><p>And one more way of iterating over a Hashtable is to query <i>KeyValuePairs</i> property 
and use pairs of key and value in <b>foreach</b> statement:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">foreach</span><span style="color: rgb(0, 0, 0);">(</span> <span style="color: rgb(0, 0, 0);">(</span>key, value<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">in</span> hash.KeyValuePairs<span style="color: rgb(0, 0, 0);">)</span>
  WriteLine<span style="color: rgb(0, 0, 0);">(</span>key, value<span style="color: rgb(0, 0, 0);">)</span>;</pre>

<!-- Saved in parser cache with key wiki:pcache:idhash:995-0!1!0!0!!en!2 and timestamp 20060120230857 -->
<a name="chunk-Gtk_text_editor_(tutorial)"></a>
	  	  <h1 class="firstHeading">Gtk text editor (tutorial)</h1>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Simple_text_editor_in_GTK.23"><span class="tocnumber">1</span> <span class="toctext">Simple text editor in GTK#</span></a>
<ul>
<li class="toclevel-2"><a href="#Compiling_examples"><span class="tocnumber">1.1</span> <span class="toctext">Compiling examples</span></a></li>
<li class="toclevel-2"><a href="#Part_I__creating_a_window"><span class="tocnumber">1.2</span> <span class="toctext">Part I  creating a window</span></a></li>
<li class="toclevel-2"><a href="#Part_II__adding_text_input_section"><span class="tocnumber">1.3</span> <span class="toctext">Part II  adding text input section</span></a></li>
<li class="toclevel-2"><a href="#Part_III_a_simple_menu"><span class="tocnumber">1.4</span> <span class="toctext">Part III a simple menu</span></a></li>
<li class="toclevel-2"><a href="#Part_IV__adding_submenus"><span class="tocnumber">1.5</span> <span class="toctext">Part IV  adding submenus</span></a></li>
<li class="toclevel-2"><a href="#Part_V__adding_tasks_to_the_submenus"><span class="tocnumber">1.6</span> <span class="toctext">Part V  adding tasks to the submenus</span></a></li>
<li class="toclevel-2"><a href="#Result"><span class="tocnumber">1.7</span> <span class="toctext">Result</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Simple_text_editor_in_GTK.23"></a><h2> Simple text editor in GTK# </h2>
<p>In this tutorial you will see step-by-step how to build a simple text editor 
in Nemerle using Gtk#. Gtk# is a .Net binding for the <a href="http://www.gtk.org/" class="external text" title="http://www.gtk.org/">GTK+</a> 
GUI toolkit. It is an alternative to <a href="#chunk-System.Windows.Forms_tutorial" title="System.Windows.Forms tutorial">Windows.Forms</a>.
</p><p>The final appearence of our application will be something like:
</p><p><a href="http://wiki.nemerle.org/Image:Vsedit.png" class="image" title="Image:Vsedit.png"><img src="Tutorials_and_examples_files/Vsedit.png" alt="Image:Vsedit.png" longdesc="/Image:Vsedit.png" width="312" height="229"></a>
</p>
<a name="Compiling_examples"></a><h3> Compiling examples </h3>
<p>In order to compile and run examples presented below, you need to install <a href="http://gtk-sharp.sourceforge.net/" class="external text" title="http://gtk-sharp.sourceforge.net/">Gtk#</a>. Assuming you have pkg-config installed, you can compile gtk# examples using
</p>
<pre> ncc example.n -pkg:gtk-sharp -out:example.exe
</pre>
<p>Otherwise you will need to copy gtk-sharp.dll to the current directory and use
</p>
<pre> ncc example.n -r:gtk-sharp.dll -out:example.exe
</pre>
<a name="Part_I__creating_a_window"></a><h3> Part I  creating a window </h3>
<p>First we must create an application and display a window, which will be the base of our editor:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> Gtk;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MainWindow&nbsp;: Window
<span style="color: rgb(0, 0, 0);">{</span>
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
	<span style="color: rgb(0, 0, 0);">{</span>
                <span style="color: rgb(0, 128, 128); font-style: italic;">// set caption of window</span>
		<span style="color: rgb(6, 0, 255);">base</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Very Simple Editor"</span><span style="color: rgb(0, 0, 0);">)</span>;
                <span style="color: rgb(0, 128, 128); font-style: italic;">// resize windows to some reasonable shape</span>
		SetSizeRequest <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">200</span><span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> SimpleEditor
<span style="color: rgb(0, 0, 0);">{</span> 
	Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
	<span style="color: rgb(0, 0, 0);">{</span>
		Application.Init<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		<span style="color: rgb(6, 0, 255);">def</span> win = MainWindow<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
                <span style="color: rgb(0, 128, 128); font-style: italic;">// exit application when editor window is deleted</span>
                win.DeleteEvent += <span style="color: rgb(6, 0, 255);">fun</span> <span style="color: rgb(0, 0, 0);">(</span>_<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> Application.Quit <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
                win.ShowAll <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		Application.Run<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>The <i>MainWindow</i> class is quite simple now, but we will add things to it in a moment.
</p><p><i>SimpleEditor</i> is a module with one method, <i>Main</i> - the entry point of our application. It is executed first when the program is run and creates the editor window.
</p><p>One more thing to note is <i>win.DeleteEvent</i>, which is a
signal triggered when the window is destroyed (for example user clicks
close). We specify what should happen by attaching an anonymous
function to the event. Here, we will simply quit the application.
</p>
<a name="Part_II__adding_text_input_section"></a><h3> Part II  adding text input section </h3>
<p>Now we need to add an area to the window where actual text can be written by the user.
</p><p>Modify the <i>MainWindow</i> class to hold the <i>TextView</i> object:
</p>
<pre class="nemerle"><span style="color: rgb(255, 0, 0);">class</span> MainWindow&nbsp;: Window
<span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(0, 128, 128); font-style: italic;">/// text input area of our window</span>
	input&nbsp;: TextView;
&nbsp;
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
	<span style="color: rgb(0, 0, 0);">{</span>
                <span style="color: rgb(0, 128, 128); font-style: italic;">// set caption of window</span>
		<span style="color: rgb(6, 0, 255);">base</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Very Simple Editor"</span><span style="color: rgb(0, 0, 0);">)</span>;
                <span style="color: rgb(0, 128, 128); font-style: italic;">// resize windows to some reasonable shape</span>
		SetSizeRequest <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">200</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
		<span style="color: rgb(6, 0, 255);">def</span> scroll = ScrolledWindow <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;		
		input = TextView <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		scroll.Add <span style="color: rgb(0, 0, 0);">(</span>input<span style="color: rgb(0, 0, 0);">)</span>;
		
                <span style="color: rgb(0, 128, 128); font-style: italic;">// place scrolledwin inside our main window</span>
           	Add <span style="color: rgb(0, 0, 0);">(</span>scroll<span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>In our window's constructor we must choose how the text input will be positioned. We use a Gtk container to encapsulate <i>TextView</i> into <i>ScrolledWindow</i>. This allows text in the text view to be easily viewed using scroll bars.
</p><p><i>Add (scroll)</i> adds the <i>ScrolledWindow</i> as part of our text editor window. So, now we have created working text input and viewing.
</p>
<a name="Part_III_a_simple_menu"></a><h3> Part III a simple menu </h3>
<p>But we still want to perform some more advanced operations in our
editor. Ha, we will even need a menu! We will create a menu and put it
into a vertical box. Instead of adding scrolling to the main window,
put it into the box as well: </p>
<pre class="nemerle">  <span style="color: rgb(6, 0, 255);">def</span> menu = MenuBar <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
  <span style="color: rgb(6, 0, 255);">def</span> mi = NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"File"</span><span style="color: rgb(0, 0, 0);">)</span>;
  menu.Append<span style="color: rgb(0, 0, 0);">(</span>mi<span style="color: rgb(0, 0, 0);">)</span>;		
		
  <span style="color: rgb(6, 0, 255);">def</span> vbox = VBox <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
  vbox.PackStart <span style="color: rgb(0, 0, 0);">(</span>menu, <span style="color: rgb(6, 0, 255);">false</span>, <span style="color: rgb(6, 0, 255);">false</span>, 0u<span style="color: rgb(0, 0, 0);">)</span>;
  vbox.PackStart <span style="color: rgb(0, 0, 0);">(</span>scroll, <span style="color: rgb(6, 0, 255);">true</span>, <span style="color: rgb(6, 0, 255);">true</span>, 0u<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
  <span style="color: rgb(0, 128, 128); font-style: italic;">// place vertical box inside our main window</span>
  Add <span style="color: rgb(0, 0, 0);">(</span>vbox<span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>In the last instruction we add the entire vertical box to the main window, above the text view.
</p><p><i>NMenuItem</i>, defined below, is the next class we will work with. We will extend it and add 
some actions to it. Here is the initial code:
</p>
<pre class="nemerle"><span style="color: rgb(255, 0, 0);">class</span> NMenuItem&nbsp;: MenuItem
<span style="color: rgb(0, 0, 0);">{</span>
	<span style="color: rgb(6, 0, 255);">public</span> name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>;
	
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span>l&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span> 
	<span style="color: rgb(0, 0, 0);">{</span>
		<span style="color: rgb(6, 0, 255);">base</span><span style="color: rgb(0, 0, 0);">(</span>l<span style="color: rgb(0, 0, 0);">)</span>;
		name = l;		
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>For now the constructor only sets the caption of the base <i>MenuItem</i>.
</p>
<a name="Part_IV__adding_submenus"></a><h3> Part IV  adding submenus </h3>
<p>We want our only menu item, <i>File</i>, to have some submenus for the tasks available in the editor. 
</p><p>Add a property to <i>NMenuItem</i>, which allows easy adding of child menus:
</p>
<pre class="nemerle"><span style="color: rgb(0, 128, 128); font-style: italic;">// class NMenuItem&nbsp;: MenuItem </span>
<span style="color: rgb(0, 128, 128); font-style: italic;">// { </span>
&nbsp;
<span style="color: rgb(0, 128, 128); font-style: italic;">// this property allows us to set submenus of this menu item</span>
<span style="color: rgb(6, 0, 255);">public</span> SubmenuList&nbsp;: list <span style="color: rgb(0, 0, 0);">[</span>NMenuItem<span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(0, 0, 0);">{</span> 
  set
  <span style="color: rgb(0, 0, 0);">{</span> 
    <span style="color: rgb(6, 0, 255);">def</span> sub = Menu<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
    <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>submenu <span style="color: rgb(6, 0, 255);">in</span> value<span style="color: rgb(0, 0, 0);">)</span> sub.Append <span style="color: rgb(0, 0, 0);">(</span>submenu<span style="color: rgb(0, 0, 0);">)</span>;
    <span style="color: rgb(6, 0, 255);">this</span>.Submenu = sub;
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(0, 128, 128); font-style: italic;">// }</span></pre>
<p><i>SubmenuList</i> simply iterates through the elements of the supplied list and adds each of them to the current instance's submenu.
</p><p>Use this property in the constructor of <i>MainWindow</i>:
</p>
<pre class="nemerle"><span style="color: rgb(0, 128, 128); font-style: italic;">// def menu = MenuBar ();</span>
<span style="color: rgb(0, 128, 128); font-style: italic;">// def mi = NMenuItem ("File");</span>
mi.SubmenuList = 
<span style="color: rgb(0, 0, 0);">[</span>
  NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Open"</span><span style="color: rgb(0, 0, 0);">)</span>,
  NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Save as..."</span><span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">]</span>;
<span style="color: rgb(0, 128, 128); font-style: italic;">// menu.Append(mi);		</span></pre>
<p>Note the commented out lines. We will uncomment these later.
</p>
<a name="Part_V__adding_tasks_to_the_submenus"></a><h3> Part V  adding tasks to the submenus </h3>
<p>Finally, we will attach actions to the items in our editor's menu. We will implement opening and saving files.
</p><p>Add a second constructor to <i>NMenuItem</i>, which will accept an action function to be perfomed after choosing the given menu item:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span>l&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>, e&nbsp;: <span style="color: rgb(255, 0, 0);">object</span> * EventArgs -&gt; <span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">)</span> 
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">base</span><span style="color: rgb(0, 0, 0);">(</span>l<span style="color: rgb(0, 0, 0);">)</span>;
  name = l;		
  <span style="color: rgb(6, 0, 255);">this</span>.Activated += e;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Like the previous one, this constructor sets the current menu item's caption, but it also attaches the given function to the <i>Activated</i> event of the item.
</p><p>Now we will define a function which will handle opening and saving files by our editor. Add it to <i>MainWindow</i>:
</p>
<pre class="nemerle"><span style="color: rgb(0, 128, 128); font-style: italic;">// handler of opening and saving files</span>
OnMenuFile <span style="color: rgb(0, 0, 0);">(</span>i&nbsp;: <span style="color: rgb(255, 0, 0);">object</span>, _&nbsp;: EventArgs<span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">def</span> mi = i&nbsp;:&gt; NMenuItem;
  <span style="color: rgb(6, 0, 255);">def</span> fs = FileSelection <span style="color: rgb(0, 0, 0);">(</span>mi.name<span style="color: rgb(0, 0, 0);">)</span>;
		
  <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>fs.Run <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> == ResponseType.Ok&nbsp;:&gt; <span style="color: rgb(255, 0, 0);">int</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">match</span> <span style="color: rgb(0, 0, 0);">(</span>mi.name<span style="color: rgb(0, 0, 0);">)</span>
  <span style="color: rgb(0, 0, 0);">{</span>
    | <span style="color: rgb(128, 128, 128);">"Open"</span> =&gt;
       <span style="color: rgb(6, 0, 255);">def</span> stream = IO.StreamReader <span style="color: rgb(0, 0, 0);">(</span>fs.Filename<span style="color: rgb(0, 0, 0);">)</span>;
       input.Buffer.Text = stream.ReadToEnd<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
    | <span style="color: rgb(128, 128, 128);">"Save as..."</span> =&gt;
       <span style="color: rgb(6, 0, 255);">def</span> s = IO.StreamWriter<span style="color: rgb(0, 0, 0);">(</span>fs.Filename<span style="color: rgb(0, 0, 0);">)</span>;
       s.Write<span style="color: rgb(0, 0, 0);">(</span>input.Buffer.Text<span style="color: rgb(0, 0, 0);">)</span>;
       s.Close<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
    | _ =&gt; <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
  <span style="color: rgb(0, 0, 0);">}</span>;
  fs.Hide<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>This method creates a window for selecting files (Gtk <i>FileSelection</i>), checks which menu item it was called from, and takes the appropriate action. Here we match on the name of <i>NMenuItem</i>, but you could also use something like <b>enum</b>s to distinguish various menu items (or attach a specific handler to each of them). 
</p><p>Actions performed for opening and saving files are quite simple - we use <i>Buffer.Text</i> properties of <i>TextView</i> to get and set the contents of the editor.
</p><p>The last thing to do is actually create the menu items using
handlers. Uncomment the lines we entered in the earlier step to read:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> menu = MenuBar <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(6, 0, 255);">def</span> mi = NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"File"</span><span style="color: rgb(0, 0, 0);">)</span>;
mi.SubmenuList = 
<span style="color: rgb(0, 0, 0);">[</span>
   NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Open"</span>, OnMenuFile<span style="color: rgb(0, 0, 0);">)</span>,
   NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Save as..."</span>, OnMenuFile<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">]</span>;
menu.Append<span style="color: rgb(0, 0, 0);">(</span>mi<span style="color: rgb(0, 0, 0);">)</span>;</pre>
<a name="Result"></a><h3> Result </h3>
<p>The result of these steps can be accessed <a href="http://nemerle.org/svn/nemerle/trunk/snippets/gtk/vsedit/vsedit.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/gtk/vsedit/vsedit.n">here</a> and it looks like this:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> Gtk;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> NMenuItem&nbsp;: MenuItem
<span style="color: rgb(0, 0, 0);">{</span>
	<span style="color: rgb(6, 0, 255);">public</span> name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>;
	
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span>l&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span> 
	<span style="color: rgb(0, 0, 0);">{</span>
		<span style="color: rgb(6, 0, 255);">base</span><span style="color: rgb(0, 0, 0);">(</span>l<span style="color: rgb(0, 0, 0);">)</span>;
		name = l;		
	<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span>l&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>, e&nbsp;: <span style="color: rgb(255, 0, 0);">object</span> * EventArgs -&gt; <span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">)</span> 
	<span style="color: rgb(0, 0, 0);">{</span>
		<span style="color: rgb(6, 0, 255);">base</span><span style="color: rgb(0, 0, 0);">(</span>l<span style="color: rgb(0, 0, 0);">)</span>;
		name = l;		
		<span style="color: rgb(6, 0, 255);">this</span>.Activated += e;
	<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
&nbsp;
        <span style="color: rgb(0, 128, 128); font-style: italic;">// this property allows us to set submenus of this menu item</span>
	<span style="color: rgb(6, 0, 255);">public</span> SubmenuList&nbsp;: list <span style="color: rgb(0, 0, 0);">[</span>NMenuItem<span style="color: rgb(0, 0, 0);">]</span>
	<span style="color: rgb(0, 0, 0);">{</span> 
		set
		<span style="color: rgb(0, 0, 0);">{</span> 
			<span style="color: rgb(6, 0, 255);">def</span> sub = Menu<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
                        <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>submenu <span style="color: rgb(6, 0, 255);">in</span> value<span style="color: rgb(0, 0, 0);">)</span> sub.Append <span style="color: rgb(0, 0, 0);">(</span>submenu<span style="color: rgb(0, 0, 0);">)</span>;
			<span style="color: rgb(6, 0, 255);">this</span>.Submenu = sub;
		<span style="color: rgb(0, 0, 0);">}</span>
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MainWindow&nbsp;: Window
<span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(0, 128, 128); font-style: italic;">/// text input area of our window</span>
	input&nbsp;: TextView;
&nbsp;
	<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
	<span style="color: rgb(0, 0, 0);">{</span>
                <span style="color: rgb(0, 128, 128); font-style: italic;">// set caption of window</span>
		<span style="color: rgb(6, 0, 255);">base</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Very Simple Editor"</span><span style="color: rgb(0, 0, 0);">)</span>;
                <span style="color: rgb(0, 128, 128); font-style: italic;">// resize windows to some reasonable shape</span>
		SetSizeRequest <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">200</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
		<span style="color: rgb(6, 0, 255);">def</span> scroll = ScrolledWindow <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;		
		input = TextView <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		scroll.Add <span style="color: rgb(0, 0, 0);">(</span>input<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
		<span style="color: rgb(6, 0, 255);">def</span> menu = MenuBar <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		<span style="color: rgb(6, 0, 255);">def</span> mi = NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"File"</span><span style="color: rgb(0, 0, 0);">)</span>;
		mi.SubmenuList = 
		<span style="color: rgb(0, 0, 0);">[</span>
			NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Open"</span>, OnMenuFile<span style="color: rgb(0, 0, 0);">)</span>,
			NMenuItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Save as..."</span>, OnMenuFile<span style="color: rgb(0, 0, 0);">)</span>
		<span style="color: rgb(0, 0, 0);">]</span>;
		menu.Append<span style="color: rgb(0, 0, 0);">(</span>mi<span style="color: rgb(0, 0, 0);">)</span>;		
		
		<span style="color: rgb(6, 0, 255);">def</span> vbox = VBox <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		vbox.PackStart <span style="color: rgb(0, 0, 0);">(</span>menu, <span style="color: rgb(6, 0, 255);">false</span>, <span style="color: rgb(6, 0, 255);">false</span>, 0u<span style="color: rgb(0, 0, 0);">)</span>;
	        vbox.PackStart <span style="color: rgb(0, 0, 0);">(</span>scroll, <span style="color: rgb(6, 0, 255);">true</span>, <span style="color: rgb(6, 0, 255);">true</span>, 0u<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
		<span style="color: rgb(0, 128, 128); font-style: italic;">// place vertical box inside our main window</span>
		Add <span style="color: rgb(0, 0, 0);">(</span>vbox<span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(0, 128, 128); font-style: italic;">// handler of opening and saving files</span>
	OnMenuFile <span style="color: rgb(0, 0, 0);">(</span>i&nbsp;: <span style="color: rgb(255, 0, 0);">object</span>, _&nbsp;: EventArgs<span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
	<span style="color: rgb(0, 0, 0);">{</span>
		<span style="color: rgb(6, 0, 255);">def</span> mi = i&nbsp;:&gt; NMenuItem;
		<span style="color: rgb(6, 0, 255);">def</span> fs = FileSelection <span style="color: rgb(0, 0, 0);">(</span>mi.name<span style="color: rgb(0, 0, 0);">)</span>;
		
		<span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>fs.Run <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> == ResponseType.Ok&nbsp;:&gt; <span style="color: rgb(255, 0, 0);">int</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">match</span> <span style="color: rgb(0, 0, 0);">(</span>mi.name<span style="color: rgb(0, 0, 0);">)</span>
		<span style="color: rgb(0, 0, 0);">{</span>
			| <span style="color: rgb(128, 128, 128);">"Open"</span> =&gt;
                                <span style="color: rgb(6, 0, 255);">def</span> stream = IO.StreamReader <span style="color: rgb(0, 0, 0);">(</span>fs.Filename<span style="color: rgb(0, 0, 0);">)</span>;
				input.Buffer.Text = stream.ReadToEnd<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
			| <span style="color: rgb(128, 128, 128);">"Save as..."</span> =&gt;
				<span style="color: rgb(6, 0, 255);">def</span> s = IO.StreamWriter<span style="color: rgb(0, 0, 0);">(</span>fs.Filename<span style="color: rgb(0, 0, 0);">)</span>;
				s.Write<span style="color: rgb(0, 0, 0);">(</span>input.Buffer.Text<span style="color: rgb(0, 0, 0);">)</span>;
				s.Close<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
			| _ =&gt; <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		<span style="color: rgb(0, 0, 0);">}</span>;
		fs.Hide<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> SimpleEditor
<span style="color: rgb(0, 0, 0);">{</span> 
	Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
	<span style="color: rgb(0, 0, 0);">{</span>
		Application.Init<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		<span style="color: rgb(6, 0, 255);">def</span> win = MainWindow<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
                <span style="color: rgb(0, 128, 128); font-style: italic;">// exit application when editor window is deleted</span>
                win.DeleteEvent += <span style="color: rgb(6, 0, 255);">fun</span> <span style="color: rgb(0, 0, 0);">(</span>_<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> Application.Quit <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
                win.ShowAll <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
		Application.Run<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
	<span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>

<!-- Saved in parser cache with key wiki:pcache:idhash:743-0!1!0!0!!en!2 and timestamp 20060121155613 -->
<a name="chunk-System.Windows.Forms_tutorial"></a>
	  	  <h1 class="firstHeading">System.Windows.Forms tutorial</h1>
	    	    	    <!-- start content -->
	    <p><b>Graphical User Interface (GUI) with Windows.Forms</b>
</p><p>Windows.Forms is the standard GUI toolkit for the .NET Framework. It is 
also supported by Mono. Like every other thing in the world it has its 
strong and weak points. Another GUI supported by .NET is <a href="#chunk-Gtk_text_editor_%28tutorial%29" title="Gtk text editor (tutorial)">Gtk#</a>. 
Which outguns which is up to you to judge. But before you can do that, 
get a feel for Windows.Forms by going throught this tutorial.
</p><p><b>Note 1:</b> To compile programs using Windows.Forms you will need to
include <tt>-r:System.Windows.Forms</tt> in the compile command. E.g. if
you save the examples in the file <i>MyFirstForm.n</i>, compile them with:
</p>
<pre>ncc MyFirstForm.n -r:System.Windows.Forms -o MyFirstForm.exe</pre>
<p><b>Note 2:</b> I am not going to go too much into details of every single 
thing you can do with Windows.Forms. These can be pretty easily checked in the 
<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfSystemWindowsForms.asp" class="external text" title="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfSystemWindowsForms.asp">Class reference</a>. 
I will just try to show you how to put all the bricks together.
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#The_first_step"><span class="tocnumber">1</span> <span class="toctext">The first step</span></a>
<ul>
<li class="toclevel-2"><a href="#Buttons.2C_labels_and_the_rest"><span class="tocnumber">1.1</span> <span class="toctext">Buttons, labels and the rest</span></a></li>
<li class="toclevel-2"><a href="#A_simple_menu"><span class="tocnumber">1.2</span> <span class="toctext">A simple menu</span></a></li>
<li class="toclevel-2"><a href="#Basic_events"><span class="tocnumber">1.3</span> <span class="toctext">Basic events</span></a></li>
<li class="toclevel-2"><a href="#Cleaning_up"><span class="tocnumber">1.4</span> <span class="toctext">Cleaning up</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#The_second_step"><span class="tocnumber">2</span> <span class="toctext">The second step</span></a>
<ul>
<li class="toclevel-2"><a href="#Painting"><span class="tocnumber">2.1</span> <span class="toctext">Painting</span></a></li>
<li class="toclevel-2"><a href="#Overriding_event_handlers"><span class="tocnumber">2.2</span> <span class="toctext">Overriding event handlers</span></a></li>
<li class="toclevel-2"><a href="#A_simple_animation_with_double-buffering"><span class="tocnumber">2.3</span> <span class="toctext">A simple animation with double-buffering</span></a></li>
<li class="toclevel-2"><a href="#Bitmaps_and_images"><span class="tocnumber">2.4</span> <span class="toctext">Bitmaps and images</span></a></li>
<li class="toclevel-2"><a href="#Adding_icons_to_the_menu"><span class="tocnumber">2.5</span> <span class="toctext">Adding icons to the menu</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="The_first_step"></a><h2> The first step </h2>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Drawing;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Windows.Forms;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MyFirstForm&nbsp;: Form <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>
      Application.Run<span style="color: rgb(0, 0, 0);">(</span>MyFirstForm<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>This is not too complex, is it? And it draws a pretty window on the
screen, so it is not utterly useless, either&nbsp;:)
</p><p>Let us now try to customize the window a little. All the customization
should be placed in the class constructor.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Drawing;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Windows.Forms;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MyFirstForm&nbsp;: Form <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
      Text=&amp;quot;My First Form&amp;quot;;        <span style="color: rgb(0, 128, 128); font-style: italic;">//title bar</span>
      ClientSize=Size<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">300</span><span style="color: rgb(0, 0, 0);">)</span>;    <span style="color: rgb(0, 128, 128); font-style: italic;">//size (without the title bar) in pixels</span>
      StartPosition=FormStartPosition.CenterScreen;     <span style="color: rgb(0, 128, 128); font-style: italic;">//I'm not telling</span>
      FormBorderStyle=FormBorderStyle.FixedSingle;      <span style="color: rgb(0, 128, 128); font-style: italic;">//not resizable</span>
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>
      Application.Run<span style="color: rgb(0, 0, 0);">(</span>MyFirstForm<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><a href="http://wiki.nemerle.org/Image:Form1.png" class="image" title=" An empty Windows.Forms form."><img src="Tutorials_and_examples_files/Form1.png" alt=" An empty Windows.Forms form." longdesc="/Image:Form1.png" width="304" height="329"></a>
</p><p><br>
</p>
<a name="Buttons.2C_labels_and_the_rest"></a><h3> Buttons, labels and the rest </h3>
<p>Wonderful. Now the time has come to actually display something in
our window. Let us add a slightly customized button. All you need to do
is to add the following code to the constructor of your Form class
(i.e. somewhere between <i>public this() {</i> and the first <i>}</i> after it).
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> button=Button<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   button.Text=&amp;quot;I am a button&amp;quot;;
   button.Location=Point<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">50</span>,<span style="color: rgb(255, 0, 0);">50</span><span style="color: rgb(0, 0, 0);">)</span>;
   button.BackColor=Color.Khaki;
   Controls.Add<span style="color: rgb(0, 0, 0);">(</span>button<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
<span style="color: rgb(6, 0, 255);">def</span> label=Label<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   label.Text=&amp;quot;I am a label&amp;quot;;
   label.Location=Point<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">200</span>,<span style="color: rgb(255, 0, 0);">200</span><span style="color: rgb(0, 0, 0);">)</span>;
   label.BorderStyle=BorderStyle.Fixed3D;
   label.Cursor=Cursors.Hand;
   Controls.Add<span style="color: rgb(0, 0, 0);">(</span>label<span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>I hope it should pretty doable to guess what is which line
responsible for. Perhaps you could only pay a little more attention to
the last one. Buttons, labels, textboxes, panels and the like are all
controls, and simply defining them is not enough, unless you want them
to be invisible.
Also, the button we have added does actually nothing. But fear not, we
shall discuss
a bit of events very soon.
</p><p><br>
</p>
<a name="A_simple_menu"></a><h3> A simple menu </h3>
<p>Menus are not hard. Just take a look at the following example:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> mainMenu=MainMenu<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
<span style="color: rgb(6, 0, 255);">def</span> mFile=mainMenu.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;File&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(6, 0, 255);">def</span> mFileDont=mFile.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;Don't quit&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(6, 0, 255);">def</span> mFileQuit=mFile.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;Quit&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
<span style="color: rgb(6, 0, 255);">def</span> mHelp=mainMenu.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;Help&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(6, 0, 255);">def</span> mHelpHelp=mHelp.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;Help&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
Menu=mainMenu;</pre>
<p>It will create a menu with two drop-down submenus: <i>File</i> (with
options <i>Don't Quit</i> and <i>Quit</i>) and <i>Help</i> with just
one option, <i>Help</i>.
</p><p><a href="http://wiki.nemerle.org/Image:Form2.png" class="image" title=" A button, a label and a menu."><img src="Tutorials_and_examples_files/Form2.png" alt=" A button, a label and a menu." longdesc="/Image:Form2.png" width="304" height="329"></a>
</p><p><br>It is also pretty easy to add context menus to controls.
Context menus are the ones which become visible when a control is
right-clicked. First, you need to define the whole menu, and than add a
reference to it to the button definition:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> buttonCM=ContextMenu<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(6, 0, 255);">def</span> bCMWhatAmI=buttonCM.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;What am I?&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(6, 0, 255);">def</span> bCMWhyAmIHere=buttonCM.MenuItems.Add<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;Why am I here?&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
...
<span style="color: rgb(6, 0, 255);">def</span> button=Button<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   ...
   button.ContextMenu=buttonCM;</pre>
<p><a href="http://wiki.nemerle.org/Image:Form8.png" class="image" title=" A context menu."><img src="Tutorials_and_examples_files/Form8.png" alt=" A context menu." longdesc="/Image:Form8.png" width="304" height="329"></a>
</p>
<a name="Basic_events"></a><h3> Basic events </h3>
<p>Naturally, however nice it all might be, without being able to actually
serve some purpose, it is a bit pointless. Therefore, we will need to
learn handling events.  There are in fact two ways to do it. Let us take
a look at the easier one for the begnning.
</p><p>The first thing you will need to do is to add the <i>System</i> namespace:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;</pre>
<p>You can skip this step but you will have to write
<i>System.EventArgs</i> and so on instead of <i>EventArgs</i>.
</p><p>Then, you will need to add a reference to the event handler to your
controls. It is better to do it first as it is rather easy to forget
about it after having written a long and complex handler.
</p>
<pre class="nemerle">button.Click+=button_Click;
...
mFileDont.Click+=mFileDont_Click;
mFileQuit.Click+=mFileQuit_Click;
...
mHelpHelp.Click+=mHelpHelp_Click;</pre>
<p>Mind the <i>+=</i> operator instead of <i>=</i> used when customizing
the controls.
</p><p>Finally, you will need to write the handlers. Do not forget
to define the arguments they need, i.e. an <i>object</i> and an
<i>EventArgs</i>. Possibly, you will actually not use them but you have
to define them anyway. You can prefix their names with a _ to avoid
warnings at compile time.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">private</span> button_Click<span style="color: rgb(0, 0, 0);">(</span>_sender:<span style="color: rgb(255, 0, 0);">object</span>, _ea:EventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   Console.WriteLine<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;I was clicked. - Your Button&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(6, 0, 255);">private</span> mFileQuit_Click<span style="color: rgb(0, 0, 0);">(</span>_sender:<span style="color: rgb(255, 0, 0);">object</span>, _ea:EventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   Application.Exit<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>This is the way you will generally want to do it. But in this very case
the handlers are very short, and like all handlers, are not very often
used for anything else than handling events. If so, we could rewrite them
as lambda expressions which will save a good bit of space and clarity.
</p>
<pre class="nemerle">button.Click+=<span style="color: rgb(6, 0, 255);">fun</span><span style="color: rgb(0, 0, 0);">(</span>_sender:<span style="color: rgb(255, 0, 0);">object</span>, _ea:EventArgs<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">{</span>
   Console.WriteLine<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;I wrote it. - button_Click <span style="color: rgb(6, 0, 255);">as</span> a lambda&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
mFileQuit.Click+=<span style="color: rgb(6, 0, 255);">fun</span><span style="color: rgb(0, 0, 0);">(</span>_sender:<span style="color: rgb(255, 0, 0);">object</span>, _ea:EventArgs<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">{</span>
   Application.Exit<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span>;</pre>
<a name="Cleaning_up"></a><h3> Cleaning up </h3>
<p>After you are done with the whole application, you should clean
everything up. In theory, the system would do it automatically anyway
but it certainly is not a bad idea to help the system a bit. Especially
that it is not a hard thing to do at all, and only consists of two steps.
</p><p>The first step is to add a reference to <i>System.ComponentModel</i>
and define a global variable of type <i>Container</i>:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.ComponentModel;
...
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MyFirstForm&nbsp;: Form <span style="color: rgb(0, 0, 0);">{</span>
   components&nbsp;: Container = <span style="color: rgb(6, 0, 255);">null</span>;
...</pre>
<p>In the second and last step, you will need to override the <i>Dispose</i>
method. It could even fit in one line if you really wanted it to.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> Dispose<span style="color: rgb(0, 0, 0);">(</span>disposing&nbsp;: <span style="color: rgb(255, 0, 0);">bool</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>disposing<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>components!=<span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span> components.Dispose<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(6, 0, 255);">base</span>.Dispose<span style="color: rgb(0, 0, 0);">(</span>d<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><br>
</p>
<a name="The_second_step"></a><h2> The second step </h2>
<p>You should now have a basic idea as to what a form looks like. The time
has come to do some graphics.
</p><p><br>
</p>
<a name="Painting"></a><h3> Painting </h3>
<p>There is a special event used for painting. It is called Paint and you
will need to create a handler for it.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Drawing;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Windows.Forms;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> MySecondForm&nbsp;: Form <span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
      Text=&amp;quot;My Second Form&amp;quot;;
      ClientSize=Size<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">300</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
      Paint+=PaintEventHandler<span style="color: rgb(0, 0, 0);">(</span>painter<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">private</span> painter<span style="color: rgb(0, 0, 0);">(</span>_sender:<span style="color: rgb(255, 0, 0);">object</span>, pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      <span style="color: rgb(6, 0, 255);">def</span> graphics=pea.Graphics;
      <span style="color: rgb(6, 0, 255);">def</span> penBlack=Pen<span style="color: rgb(0, 0, 0);">(</span>Color.Black<span style="color: rgb(0, 0, 0);">)</span>;
      graphics.DrawLine<span style="color: rgb(0, 0, 0);">(</span>penBlack, <span style="color: rgb(255, 0, 0);">0</span>, <span style="color: rgb(255, 0, 0);">0</span> , <span style="color: rgb(255, 0, 0);">150</span>, <span style="color: rgb(255, 0, 0);">150</span><span style="color: rgb(0, 0, 0);">)</span>;
      graphics.DrawLine<span style="color: rgb(0, 0, 0);">(</span>penBlack, <span style="color: rgb(255, 0, 0);">150</span>, <span style="color: rgb(255, 0, 0);">150</span>, <span style="color: rgb(255, 0, 0);">300</span>, <span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      Application.Run<span style="color: rgb(0, 0, 0);">(</span>MySecondForm<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>A reference to the painter method should be added in the form class
constructor (it affects the whole window), but this time it is a
<b>Paint</b>EventHandler. Same as <b>Paint</b>EventArgs in the handler
itself.  In the handler, you should first define a variable of type
PaintEventArgs.Graphics. This is the whole window. This is where you will
be drawing lines, circles, strings, images and the like (but not pixels;
we will discuss bitmaps later on).  To draw all those things you will
need pens and brushes. In our example we used the same pen twice. But
sometimes you will only need it once. In such case, there is no point
in defining a separate variable for it. Take a look at the next example.
</p><p><a href="http://wiki.nemerle.org/Image:Form3.png" class="image" title=" Painting in Windows.Forms."><img src="Tutorials_and_examples_files/Form3.png" alt=" Painting in Windows.Forms." longdesc="/Image:Form3.png" width="304" height="329"></a>
</p><p><br>
</p>
<a name="Overriding_event_handlers"></a><h3> Overriding event handlers </h3>
<p>Another way to define a handler is to override the default one provided
by the framework. It is not at all complicated, it is not dangerous and
in many cases it will prove much more useful. Take a look at the example
overriding the OnPaint event handler:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnPaint<span style="color: rgb(0, 0, 0);">(</span>pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">def</span> g=pea.Graphics;
   g.DrawLine<span style="color: rgb(0, 0, 0);">(</span>Pen<span style="color: rgb(0, 0, 0);">(</span>Color.Black<span style="color: rgb(0, 0, 0);">)</span>, <span style="color: rgb(255, 0, 0);">50</span>, <span style="color: rgb(255, 0, 0);">50</span>, <span style="color: rgb(255, 0, 0);">150</span>, <span style="color: rgb(255, 0, 0);">150</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Naturally, when you override the handler, there is no need any longer
to add a reference to it in the class constructor.
</p><p>By the same token can you override other events. One of the possible
uses is to define quite complex clickable areas pretty easily:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnPaint<span style="color: rgb(0, 0, 0);">(</span>pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">def</span> g=pea.Graphics;
   <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> x=<span style="color: rgb(255, 0, 0);">0</span>; x&lt;<span style="color: rgb(255, 0, 0);">300</span>; x+=<span style="color: rgb(255, 0, 0);">10</span><span style="color: rgb(0, 0, 0);">)</span> g.DrawLine<span style="color: rgb(0, 0, 0);">(</span>Pen<span style="color: rgb(0, 0, 0);">(</span>Color.Blue<span style="color: rgb(0, 0, 0);">)</span>, x, <span style="color: rgb(255, 0, 0);">0</span>, x, <span style="color: rgb(255, 0, 0);">300</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnMouseDown<span style="color: rgb(0, 0, 0);">(</span>mea:MouseEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>mea.X%<span style="color: rgb(255, 0, 0);">10</span>&lt;<span style="color: rgb(255, 0, 0);">4</span> &amp;&amp; mea.Button==MouseButtons.Left<span style="color: rgb(0, 0, 0);">)</span>
      <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>mea.X%<span style="color: rgb(255, 0, 0);">10</span>==<span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span> Console.WriteLine<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;You left-clicked a line.&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>
      <span style="color: rgb(6, 0, 255);">else</span> Console.WriteLine<span style="color: rgb(0, 0, 0);">(</span>$&amp;quot;You almost left-clicked a line <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>mea.X%<span style="color: rgb(255, 0, 0);">10</span><span style="color: rgb(0, 0, 0);">)</span> pixels<span style="color: rgb(0, 0, 0);">)</span>.&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><a href="http://wiki.nemerle.org/Image:Form7.png" class="image" title=" Easily creating a complex clickable image map."><img src="Tutorials_and_examples_files/Form7.png" alt=" Easily creating a complex clickable image map." longdesc="/Image:Form7.png" width="304" height="329"></a>
</p><p><br>
</p>
<a name="A_simple_animation_with_double-buffering"></a><h3> A simple animation with double-buffering </h3>
<p>What is an animation without double-buffering? Usually, a flickering
animation. We do not want that. Luckily enough, double-buffering is as
easy as abc in Windows.Forms.
In fact, all you need to do is to set three style flags and override the
OnPaint event handler instead of writing your own handler and assigning
it to the event.
</p>
<pre class="nemerle"><span style="color: rgb(255, 0, 0);">class</span> Animation:Form<span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">mutable</span> mouseLocation:Point;         <span style="color: rgb(0, 128, 128); font-style: italic;">//the location of the cursor</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">{</span>
      Text=&amp;quot;A simple animation&amp;quot;;
      ClientSize=Size<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">300</span><span style="color: rgb(0, 0, 0);">)</span>;
      SetStyle<span style="color: rgb(0, 0, 0);">(</span>ControlStyles.UserPaint | ControlStyles.AllPaintingInWmPaint |
               ControlStyles.DoubleBuffer, <span style="color: rgb(6, 0, 255);">true</span><span style="color: rgb(0, 0, 0);">)</span>;         <span style="color: rgb(0, 128, 128); font-style: italic;">//double-buffering on</span>
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnPaint<span style="color: rgb(0, 0, 0);">(</span>pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      <span style="color: rgb(6, 0, 255);">def</span> g=pea.Graphics;
      g.FillRectangle<span style="color: rgb(0, 0, 0);">(</span>SolidBrush<span style="color: rgb(0, 0, 0);">(</span>Color.DimGray<span style="color: rgb(0, 0, 0);">)</span>,<span style="color: rgb(255, 0, 0);">0</span>,<span style="color: rgb(255, 0, 0);">0</span>,<span style="color: rgb(255, 0, 0);">300</span>,<span style="color: rgb(255, 0, 0);">300</span><span style="color: rgb(0, 0, 0);">)</span>;  <span style="color: rgb(0, 128, 128); font-style: italic;">//clearing the window</span>
&nbsp;
      <span style="color: rgb(6, 0, 255);">def</span> penRed=Pen<span style="color: rgb(0, 0, 0);">(</span>Color.Red<span style="color: rgb(0, 0, 0);">)</span>;
      g.FillEllipse<span style="color: rgb(0, 0, 0);">(</span>SolidBrush<span style="color: rgb(0, 0, 0);">(</span>Color.LightGray<span style="color: rgb(0, 0, 0);">)</span>,
                    mouseLocation.X-<span style="color: rgb(255, 0, 0);">15</span>, mouseLocation.Y-<span style="color: rgb(255, 0, 0);">15</span>, <span style="color: rgb(255, 0, 0);">29</span>, <span style="color: rgb(255, 0, 0);">29</span><span style="color: rgb(0, 0, 0);">)</span>;
      g.DrawEllipse<span style="color: rgb(0, 0, 0);">(</span>penRed, mouseLocation.X-<span style="color: rgb(255, 0, 0);">15</span>, mouseLocation.Y-<span style="color: rgb(255, 0, 0);">15</span>, <span style="color: rgb(255, 0, 0);">30</span>, <span style="color: rgb(255, 0, 0);">30</span><span style="color: rgb(0, 0, 0);">)</span>;
      g.DrawLine<span style="color: rgb(0, 0, 0);">(</span>penRed, mouseLocation.X, mouseLocation.Y-<span style="color: rgb(255, 0, 0);">20</span>,
                 mouseLocation.X, mouseLocation.Y+<span style="color: rgb(255, 0, 0);">20</span><span style="color: rgb(0, 0, 0);">)</span>;
      g.DrawLine<span style="color: rgb(0, 0, 0);">(</span>penRed, mouseLocation.X-<span style="color: rgb(255, 0, 0);">20</span>, mouseLocation.Y,
                 mouseLocation.X+<span style="color: rgb(255, 0, 0);">20</span>, mouseLocation.Y<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnMouseMove<span style="color: rgb(0, 0, 0);">(</span>mea:MouseEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      mouseLocation=Point<span style="color: rgb(0, 0, 0);">(</span>mea.X,mea.Y<span style="color: rgb(0, 0, 0);">)</span>;
      Invalidate<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;       <span style="color: rgb(0, 128, 128); font-style: italic;">//redraw the screen every time the mouse moves</span>
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      Application.Run<span style="color: rgb(0, 0, 0);">(</span>Animation<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>As you can see, the basic structure of a window with animation is
pretty easy. <i>Main</i> starts the whole thing as customized in the
constructor. The <i>OnPaint</i> event handler is called immediately. And
then the whole thing freezes waiting for you to move the mouse. When
you do, the <i>OnMouseMove</i> event handler is called. It checks the
new position of the mouse, stores it in <i>mouseLocation</i> and tells
the window to redraw (<i>Invalidate();</i>).
</p><p>Try turning double-buffering off (i.e. comment the <i>SetStyle...</i>
line) and moving the mouse slowly. You will see the viewfinder
flicker. Now turn double-buffering back on and try again. See the
difference?
</p><p>Well, in this example you have to move the mouse slowly to actually
see any difference because the viewfinder we are drawing is a pretty
easy thing to draw. But you can be sure that whenever anything more
complex comes into play, the difference is very well visible without
any extra effort.
</p><p><a href="http://wiki.nemerle.org/Image:Form4.png" class="image" title=" A simple animation with double-buffering."><img src="Tutorials_and_examples_files/Form4.png" alt=" A simple animation with double-buffering." longdesc="/Image:Form4.png" width="304" height="329"></a>
</p><p><br>
</p>
<a name="Bitmaps_and_images"></a><h3> Bitmaps and images </h3>
<p>I promised I would tell you how to draw a single pixel. Well, here we are.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnPaint<span style="color: rgb(0, 0, 0);">(</span>pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">def</span> g=pea.Graphics;
   <span style="color: rgb(6, 0, 255);">def</span> bmp=Bitmap<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">256</span>,<span style="color: rgb(255, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">)</span>;   <span style="color: rgb(0, 128, 128); font-style: italic;">//one pixel height is enough; we can draw it many times</span>
   <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> i=<span style="color: rgb(255, 0, 0);">0</span>; i&lt;<span style="color: rgb(255, 0, 0);">256</span>; ++i<span style="color: rgb(0, 0, 0);">)</span> bmp.SetPixel<span style="color: rgb(0, 0, 0);">(</span>i, <span style="color: rgb(255, 0, 0);">0</span>, Color.FromArgb<span style="color: rgb(0, 0, 0);">(</span>i,<span style="color: rgb(255, 0, 0);">0</span>,i,<span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> y=<span style="color: rgb(255, 0, 0);">10</span>; y&lt;<span style="color: rgb(255, 0, 0);">20</span>; ++y<span style="color: rgb(0, 0, 0);">)</span> g.DrawImage<span style="color: rgb(0, 0, 0);">(</span>bmp, <span style="color: rgb(255, 0, 0);">0</span>, y<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>So, what do we do here? We define a bitmap of size 256,1. We draw onto
it 256 pixels in colours defined by four numbers: alpha (transparency),
red, green, and blue. But as we are only manipulating alpha and green,
we will get a nicely shaded green line. Finally, we draw the bitmap onto
the window ten times, one below another.
</p><p>Mind the last step, it is very important. The bitmap we had defined is
an offset one. Drawing onto it does not affect the screen in any way.
</p><p>Now, that you know the <i>DrawImage</i> method nothing can stop you from
filling your window with all the graphic files you might be having on
your disk, and modifying them according to your needs.
</p>
<pre class="nemerle"><span style="color: rgb(255, 0, 0);">class</span> ImageWithAFilter:Form<span style="color: rgb(0, 0, 0);">{</span>
   img:Image=Image.FromFile<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;/home/johnny/pics/doggy.png&amp;quot;<span style="color: rgb(0, 0, 0);">)</span>;  <span style="color: rgb(0, 128, 128); font-style: italic;">//load an image</span>
   bmp:Bitmap=Bitmap<span style="color: rgb(0, 0, 0);">(</span>img<span style="color: rgb(0, 0, 0);">)</span>;       <span style="color: rgb(0, 128, 128); font-style: italic;">//create a bitmap from the image</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">{</span>
      ClientSize=Size<span style="color: rgb(0, 0, 0);">(</span>bmp.Width*<span style="color: rgb(255, 0, 0);">2</span>, bmp.Height<span style="color: rgb(0, 0, 0);">)</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
   <span style="color: rgb(6, 0, 255);">protected</span> <span style="color: rgb(6, 0, 255);">override</span> OnPaint<span style="color: rgb(0, 0, 0);">(</span>pea:PaintEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
      <span style="color: rgb(6, 0, 255);">def</span> g=pea.Graphics;
      <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> x=<span style="color: rgb(255, 0, 0);">0</span>; x&lt;bmp.Width; ++x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> y=<span style="color: rgb(255, 0, 0);">0</span>; y&lt;bmp.Height; ++y<span style="color: rgb(0, 0, 0);">)</span>
         <span style="color: rgb(6, 0, 255);">when</span> <span style="color: rgb(0, 0, 0);">(</span>bmp.GetPixel<span style="color: rgb(0, 0, 0);">(</span>x,y<span style="color: rgb(0, 0, 0);">)</span>.R&gt;<span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(6, 0, 255);">def</span> g=bmp.GetPixel<span style="color: rgb(0, 0, 0);">(</span>x,y<span style="color: rgb(0, 0, 0);">)</span>.G;
            <span style="color: rgb(6, 0, 255);">def</span> b=bmp.GetPixel<span style="color: rgb(0, 0, 0);">(</span>x,y<span style="color: rgb(0, 0, 0);">)</span>.B;
            bmp.SetPixel<span style="color: rgb(0, 0, 0);">(</span>x,y,Color.FromArgb<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">255</span>,<span style="color: rgb(255, 0, 0);">0</span>,g,b<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
         <span style="color: rgb(0, 0, 0);">}</span>
      g.DrawImage<span style="color: rgb(0, 0, 0);">(</span>img,<span style="color: rgb(255, 0, 0);">0</span>,<span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span>;            <span style="color: rgb(0, 128, 128); font-style: italic;">//draw the original image on the left</span>
      g.DrawImage<span style="color: rgb(0, 0, 0);">(</span>bmp,img.Width,<span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span>;    <span style="color: rgb(0, 128, 128); font-style: italic;">//draw the modified image on the right</span>
   <span style="color: rgb(0, 0, 0);">}</span>
   
   ...
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>This example draws two pictures: the original one on the left and the
modified one on the right. The modification is a very simple filter
entirely removing the red colour.
</p><p><a href="http://wiki.nemerle.org/Image:Form5.png" class="image" title=" A simple graphic filter."><img src="Tutorials_and_examples_files/Form5.png" alt=" A simple graphic filter." longdesc="/Image:Form5.png" width="478" height="275"></a>
</p><p><br>
</p>
<a name="Adding_icons_to_the_menu"></a><h3> Adding icons to the menu </h3>
<p>Adding icons is unfortunately a little bit more complicated than other
things in Windows.Forms.
</p><p>You will need to provide handlers for two events: <i>MeasureItem</i>
and <i>DrawItem</i>, reference them in the right place, and set the menu
item properly.
</p>
<pre class="nemerle">mFileQuit.Click+=EventHandler<span style="color: rgb(0, 0, 0);">(</span> <span style="color: rgb(6, 0, 255);">fun</span><span style="color: rgb(0, 0, 0);">(</span>_<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>Application.Exit<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;<span style="color: rgb(0, 0, 0);">}</span> <span style="color: rgb(0, 0, 0);">)</span>;
mFileQuit.OwnerDraw=<span style="color: rgb(6, 0, 255);">true</span>;
mFileQuit.MeasureItem+=MeasureItemEventHandler<span style="color: rgb(0, 0, 0);">(</span>measureItem<span style="color: rgb(0, 0, 0);">)</span>;
mFileQuit.DrawItem+=DrawItemEventHandler<span style="color: rgb(0, 0, 0);">(</span>drawItem<span style="color: rgb(0, 0, 0);">)</span>;</pre>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">private</span> measureItem<span style="color: rgb(0, 0, 0);">(</span>sender:<span style="color: rgb(255, 0, 0);">object</span>, miea:MeasureItemEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">def</span> menuItem=sender:&gt;MenuItem;
   <span style="color: rgb(6, 0, 255);">def</span> font=Font<span style="color: rgb(0, 0, 0);">(</span>&amp;quot;FreeMono&amp;quot;,<span style="color: rgb(255, 0, 0);">8</span><span style="color: rgb(0, 0, 0);">)</span>;   <span style="color: rgb(0, 128, 128); font-style: italic;">//the name and the size of the font</span>
   miea.ItemHeight=<span style="color: rgb(0, 0, 0);">(</span>miea.Graphics.MeasureString<span style="color: rgb(0, 0, 0);">(</span>menuItem.Text,font<span style="color: rgb(0, 0, 0);">)</span>.Height+<span style="color: rgb(255, 0, 0);">5</span><span style="color: rgb(0, 0, 0);">)</span>:&gt;int;
   miea.ItemWidth=<span style="color: rgb(0, 0, 0);">(</span>miea.Graphics.MeasureString<span style="color: rgb(0, 0, 0);">(</span>menuItem.Text,font<span style="color: rgb(0, 0, 0);">)</span>.Width+<span style="color: rgb(255, 0, 0);">30</span><span style="color: rgb(0, 0, 0);">)</span>:&gt;int;
<span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
<span style="color: rgb(6, 0, 255);">private</span> drawItem<span style="color: rgb(0, 0, 0);">(</span>sender:<span style="color: rgb(255, 0, 0);">object</span>, diea:DrawItemEventArgs<span style="color: rgb(0, 0, 0);">)</span>:<span style="color: rgb(6, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">def</span> menuItem=sender:&gt;MenuItem;
   <span style="color: rgb(6, 0, 255);">def</span> g=diea.Graphics;
   diea.DrawBackground<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
   g.DrawImage<span style="color: rgb(0, 0, 0);">(</span>anImageDefinedEarlier, diea.Bounds.Left+<span style="color: rgb(255, 0, 0);">3</span>, diea.Bounds.Top+<span style="color: rgb(255, 0, 0);">3</span>, <span style="color: rgb(255, 0, 0);">20</span>, <span style="color: rgb(255, 0, 0);">15</span><span style="color: rgb(0, 0, 0);">)</span>;
   g.DrawString<span style="color: rgb(0, 0, 0);">(</span>menuItem.Text, diea.Font, SolidBrush<span style="color: rgb(0, 0, 0);">(</span>diea.ForeColor<span style="color: rgb(0, 0, 0);">)</span>,
                diea.Bounds.Left+<span style="color: rgb(255, 0, 0);">25</span>, diea.Bounds.Top+<span style="color: rgb(255, 0, 0);">3</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><a href="http://wiki.nemerle.org/Image:Form6.png" class="image" title=" A menu with an icon."><img src="Tutorials_and_examples_files/Form6.png" alt=" A menu with an icon." longdesc="/Image:Form6.png" width="304" height="329"></a>
</p>
<!-- Saved in parser cache with key wiki:pcache:idhash:1086-0!1!0!0!!en!2 and timestamp 20060121125202 -->
<a name="chunk-Macros_tutorial"></a>
	  	  <h1 class="firstHeading">Macros tutorial</h1>
	    	    	    <!-- start content -->
	    <p><b>Nemerle type-safe macros</b>
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#What_exactly_is_a_macro.3F"><span class="tocnumber">1</span> <span class="toctext">What exactly is a macro?</span></a></li>
<li class="toclevel-1"><a href="#Defining_a_new_macro"><span class="tocnumber">2</span> <span class="toctext">Defining a new macro</span></a>
<ul>
<li class="toclevel-2"><a href="#Compiling_a_simplest_macro"><span class="tocnumber">2.1</span> <span class="toctext">Compiling a simplest macro</span></a></li>
<li class="toclevel-2"><a href="#Exercise"><span class="tocnumber">2.2</span> <span class="toctext">Exercise</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Operating_on_syntax_trees"><span class="tocnumber">3</span> <span class="toctext">Operating on syntax trees</span></a>
<ul>
<li class="toclevel-2"><a href="#Quotation_operator"><span class="tocnumber">3.1</span> <span class="toctext">Quotation operator</span></a></li>
<li class="toclevel-2"><a href="#Matching_subexpressions"><span class="tocnumber">3.2</span> <span class="toctext">Matching subexpressions</span></a></li>
<li class="toclevel-2"><a href="#Base_elements_of_grammar"><span class="tocnumber">3.3</span> <span class="toctext">Base elements of grammar</span></a></li>
<li class="toclevel-2"><a href="#Constructs_with_variable_amount_of_elements"><span class="tocnumber">3.4</span> <span class="toctext">Constructs with variable amount of elements</span></a></li>
<li class="toclevel-2"><a href="#Exercise_2"><span class="tocnumber">3.5</span> <span class="toctext">Exercise</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Adding_new_syntax_to_the_compiler"><span class="tocnumber">4</span> <span class="toctext">Adding new syntax to the compiler</span></a>
<ul>
<li class="toclevel-2"><a href="#Exercise_3"><span class="tocnumber">4.1</span> <span class="toctext">Exercise</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Macros_in_custom_attributes"><span class="tocnumber">5</span> <span class="toctext">Macros in custom attributes</span></a>
<ul>
<li class="toclevel-2"><a href="#Executing_macros_on_type_declarations"><span class="tocnumber">5.1</span> <span class="toctext">Executing macros on type declarations</span></a></li>
<li class="toclevel-2"><a href="#Manipulating_type_declarations"><span class="tocnumber">5.2</span> <span class="toctext">Manipulating type declarations</span></a></li>
<li class="toclevel-2"><a href="#Execution_stages"><span class="tocnumber">5.3</span> <span class="toctext">Execution stages</span></a>
<ul>
<li class="toclevel-3"><a href="#Parameters_of_attribute_macros"><span class="tocnumber">5.3.1</span> <span class="toctext">Parameters of attribute macros</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Reference_to_more_advanced_aspects"><span class="tocnumber">6</span> <span class="toctext">Reference to more advanced aspects</span></a>
<ul>
<li class="toclevel-2"><a href="#Hygiene_and_alpha-renaming_of_identifiers"><span class="tocnumber">6.1</span> <span class="toctext">Hygiene and alpha-renaming of identifiers</span></a>
<ul>
<li class="toclevel-3"><a href="#Problem_with_names_capture"><span class="tocnumber">6.1.1</span> <span class="toctext">Problem with names capture</span></a></li>
<li class="toclevel-3"><a href="#Hygiene_of_macros"><span class="tocnumber">6.1.2</span> <span class="toctext">Hygiene of macros</span></a></li>
<li class="toclevel-3"><a href="#Controlled_breaking_hygiene"><span class="tocnumber">6.1.3</span> <span class="toctext">Controlled breaking hygiene</span></a></li>
<li class="toclevel-3"><a href="#Unhygienic_variables"><span class="tocnumber">6.1.4</span> <span class="toctext">Unhygienic variables</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="What_exactly_is_a_macro.3F"></a><h2> What exactly is a macro? </h2>
<p><br>
Basically every macro is a function, which takes a fragment
of code as parameter(s) and returns some other code. On the highest 
level of abstraction it doesn't matter if parameters are function calls, 
type definitions or just a sequence of assignments. The most important fact is 
that they are not common objects (e.g. instances of some types, like 
integer numbers), but their internal representation in the compiler (i.e. 
syntax trees).
</p><p>A macro is defined in the program just like any other function, using
common Nemerle syntax. The only difference is the structure of the data 
it operates on and the way in which it is used (executed at compile-time). 
</p><p>A macro, once created, can be used to process some parts of the code.
It's done by calling it with block(s) of code as parameter(s). 
This operation is in most cases indistinguishable from a common function
call (like <i>f(1)</i>), so a programmer using a macro would not be confused 
by unknown syntax. The main concept of our design is to make the usage of macros 
as transparent as possible. From the user point of view, it is not 
important if particular parameters are passed to a macro, 
(which would process them at the compile-time and insert some new 
code in their place), or to an ordinary function.
</p>
<a name="Defining_a_new_macro"></a><h2> Defining a new macro </h2>
<p>Writing a macro is as simple as writing a common function. It looks
the same, except that it is preceded by a keyword <tt>macro</tt> and it lives at the top level (not inside any class). 
This will make the compiler know about how to use the defined method 
(i.e. run it at the compile-time in every place where it is used). 
</p><p>Macros can take zero (if we just want to generate new code)
or more parameters. They are all elements of the language 
grammar, so their type is limited to the set of defined
syntax objects. The same holds for a return value of a macro.
</p><p>Example:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> generate_expression <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  MyModule.compute_some_expression <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>This example macro does not take any parameters and is used in the
code by simply writing <tt>generate_expression ();</tt>. 
The most important is the difference between <tt>generate_expression</tt>
and <tt>compute_some_expression</tt> - the first one is a function
executed by the compiler during compilation, while the latter is just
some common function that must return syntax tree of expressions
(which is here returned and inserted into program code by
<tt>generate_expression</tt>).
</p>
<a name="Compiling_a_simplest_macro"></a><h3> Compiling a simplest macro </h3>
<p>In order to create and use a macro you have to write a
library, which will contain its executable form. You simply 
create a new file <tt>mymacro.n</tt>, which can contain for 
example
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> m <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(0, 0, 0);">Nemerle</span>.IO.printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"compile-time<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span><span style="color: rgb(0, 0, 0);">)</span>;
  &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.IO.printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"run-time<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>and compile it with command
</p>
<pre>ncc -r Nemerle.Compiler.dll -t:dll mymacro.n -o mymacro.dll
</pre>
<p>Now you can use <tt>m()</tt> in any program, like here
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">module</span> M <span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">public</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>
    m <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>You must add a reference to <tt>mymacro.dll</tt> during 
compilation of this program. It might look like
</p>
<pre>ncc -r mymacro.dll myprog.n -o myprog.exe
</pre>
<a name="Exercise"></a><h3> Exercise </h3>
<p>Write a macro, which, when used, should slow down the compilation by 5 seconds
(use <tt>System.Timers</tt> namespace) and print the version of the operating
system used to compile program (use <tt>System.Environment</tt> namespace).
</p>
<a name="Operating_on_syntax_trees"></a><h2> Operating on syntax trees </h2>
<p>Definition of function <tt>compute_some_expression</tt> might look
like:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Compiler.Parsetree;
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> MyModule 
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">mutable</span> debug_on&nbsp;: <span style="color: rgb(255, 0, 0);">bool</span>;
&nbsp;
  <span style="color: rgb(6, 0, 255);">public</span> compute_some_expression <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: PExpr 
  <span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>debug_on<span style="color: rgb(0, 0, 0);">)</span> 
      &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Hello, I'm debug message"</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;
    <span style="color: rgb(6, 0, 255);">else</span>
      &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>The examples above show a macro, which conditionally inlines expression
printing a message. It's not quite useful yet, but it has introduced the
meaning of compile-time computations and also some new syntax used only 
in writing macros and functions operating on syntax trees.
We have written here the <tt>&lt;[ ... ]&gt;</tt> constructor to
build a syntax tree of expression (e.g. '<tt>()</tt>').
</p>
<a name="Quotation_operator"></a><h3> Quotation operator </h3>
<p><tt>&lt;[ ... ]&gt;</tt> is used to both construction and 
decomposition of syntax trees. Those operations are similar to
quotation of code. Simply, everything which is written inside 
<tt>&lt;[ ... ]&gt;</tt>, corresponds to its own syntax tree. 
It can be any valid Nemerle code, so a programmer does not have to 
learn internal representation of syntax trees in the compiler.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> print_date <span style="color: rgb(0, 0, 0);">(</span>at_compile_time<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>                   
  <span style="color: rgb(6, 0, 255);">match</span> <span style="color: rgb(0, 0, 0);">(</span>at_compile_time<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
    | &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">true</span> <span style="color: rgb(0, 0, 0);">]</span>&gt; =&gt; MyModule.print_compilation_time <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
    | _ =&gt; &lt;<span style="color: rgb(0, 0, 0);">[</span> WriteLine <span style="color: rgb(0, 0, 0);">(</span>DateTime.Now.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>The quotation alone allows using only constant expressions, which
is insufficient for most tasks. For example, to write function
<tt>print_compilation_time</tt> we must be able to create an expression
based on a value known at the compile-time. In next sections we introduce
the rest of macros' syntax to operate on general syntax trees.
</p>
<a name="Matching_subexpressions"></a><h3> Matching subexpressions </h3>
<p>When we want to decompose some large code (or more precisely, 
its syntax tree), we must bind its smaller parts to variables.
Then we can process them recursively or just use them in an
arbitrary way to construct the result.
</p><p>We can operate on entire subexpressions by writing 
<tt>$( ... )</tt> or <tt>$ID</tt> inside the quotation operator 
<tt>&lt;[ ... ]&gt;</tt>. This means binding the value of 
<tt>ID</tt> or the interior of parenthesized expression to the part of 
syntax tree described by corresponding quotation.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span>init, cond, change, body<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  &lt;<span style="color: rgb(0, 0, 0);">[</span> 
    $init;
    <span style="color: rgb(6, 0, 255);">def</span> loop <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span> <span style="color: rgb(0, 0, 0);">{</span>
      <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>$cond<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> $body; $change; loop<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">}</span> 
      <span style="color: rgb(6, 0, 255);">else</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
    <span style="color: rgb(0, 0, 0);">}</span>;
    loop <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
  <span style="color: rgb(0, 0, 0);">]</span>&gt;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>The above macro defines function <tt>for</tt>, which is
similar to the loop known from C. It can be used like this
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> i = <span style="color: rgb(255, 0, 0);">0</span>, i &lt; <span style="color: rgb(255, 0, 0);">10</span>, i++, printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"%d"</span>, i<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span></pre>
<p>Later we show how to extend the language syntax to make the syntax
of <tt>for</tt> exactly as in C.
</p>
<a name="Base_elements_of_grammar"></a><h3> Base elements of grammar </h3>
<p>Sometimes quoted expressions have literals inside of them
(like strings, integers, etc.) and we want to operate on
their value, not on their syntax trees. It is possible, 
because they are constant expressions and their runtime
value is known at the compile-time. 
</p><p>Let's consider the previously used function <tt>print_compilation_time</tt>. 
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Compiler.Parsetree;
&nbsp;
<span style="color: rgb(6, 0, 255);">module</span> MyModule <span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">public</span> print_compilation_time <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: PExpr
  <span style="color: rgb(0, 0, 0);">{</span>                   
    &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>DateTime.Now.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Here we see some new extension of splicing syntax where we 
create a syntax tree of string literal from a known value.
It is done by adding <tt>: string</tt> inside the
<tt>$(...)</tt> construct. One can think about it as of
enforcing the type of spliced expression to a literal (similar
to common Nemerle type enforcement), but in the matter
of fact something more is happening here - a real value
is lifted to its representation as syntax tree of a literal.
</p><p>Other types of literals (<tt>int</tt>, <tt>bool</tt>, <tt>float</tt>, 
<tt>char</tt>) are treated the same.  
This notation can be used also in pattern matching. We can
match constant values in expressions this way.
</p><p>There is also a similar schema for splicing and matching 
variables of a given name. <tt>$(v&nbsp;: name)</tt> denotes a
variable, whose name is contained by object <tt>v</tt> 
(of special type <tt>Name</tt>). There are some good 
<a href="http://wiki.nemerle.org/Macros#Problem_with_names_capture" title="Macros">reasons</a> for encapsulating a real identifier
within this object. 
</p>
<a name="Constructs_with_variable_amount_of_elements"></a><h3> Constructs with variable amount of elements </h3>
<p>You might have noticed, that Nemerle has a few grammar elements, 
which are composed of a list of subexpressions. For example, a sequence
of expressions enclosed with <tt>{</tt> .. <tt>}</tt> braces may
contain zero or more elements. 
</p><p>When splicing values of some expressions, we would like to decompose
or compose such constructs in a general way - i.e. obtain all expressions
in a given sequence. It is natural to think about them as if a list of 
expressions and to bind this list to some variable in meta-language. 
It is done with special syntax <tt>..</tt>:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">mutable</span> exps = <span style="color: rgb(0, 0, 0);">[</span> &lt;<span style="color: rgb(0, 0, 0);">[</span> printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"%d "</span>, x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;, &lt;<span style="color: rgb(0, 0, 0);">[</span> printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"%d "</span>, y<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt; <span style="color: rgb(0, 0, 0);">]</span>;
exps = &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> x = <span style="color: rgb(255, 0, 0);">1</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;&nbsp;:: &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> y = <span style="color: rgb(255, 0, 0);">2</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;&nbsp;:: exps;
&lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">{</span>.. $exps <span style="color: rgb(0, 0, 0);">}</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;</pre>
<p>We have used <tt>{ .. $exps }</tt> here to create the sequence of 
expressions from list <tt>exps&nbsp;: list&lt;Expr&gt;;</tt>. 
A similar syntax is used to splice the content of tuples (<tt>( .. $elist )</tt>) 
and other constructs, like <tt>array []</tt>:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Collections;
&nbsp;
<span style="color: rgb(6, 0, 255);">macro</span> castedarray <span style="color: rgb(0, 0, 0);">(</span>e<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
 <span style="color: rgb(6, 0, 255);">match</span> <span style="color: rgb(0, 0, 0);">(</span>e<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
  | &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span>.. $elements <span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(0, 0, 0);">]</span>&gt; =&gt;
     <span style="color: rgb(6, 0, 255);">def</span> casted = List.Map <span style="color: rgb(0, 0, 0);">(</span>elements, <span style="color: rgb(6, 0, 255);">fun</span> <span style="color: rgb(0, 0, 0);">(</span>x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(0, 0, 0);">(</span>$x&nbsp;: <span style="color: rgb(255, 0, 0);">object</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt; <span style="color: rgb(0, 0, 0);">}</span><span style="color: rgb(0, 0, 0);">)</span>;
     &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span>.. $casted<span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;
  | _ =&gt; e
 <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>If the exact number of expressions in tuple/sequence is known during
writing the quotation, then it can be expressed with
</p>
<pre class="nemerle">&lt;<span style="color: rgb(0, 0, 0);">[</span> $e_<span style="color: rgb(255, 0, 0);">1</span>; $e_<span style="color: rgb(255, 0, 0);">2</span>; $e_<span style="color: rgb(255, 0, 0);">3</span>; x = <span style="color: rgb(255, 0, 0);">2</span>; f <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;</pre>
<p>The <tt>..</tt> syntax is used when there are <tt>e_i&nbsp;: Expr</tt> for
<tt>1 &lt;= i &lt;= n</tt>.
</p>
<a name="Exercise_2"></a><h3> Exercise </h3>
<p>Write a macro <tt>rotate</tt>, which takes two parameters: a pair of
floating point numbers (describing a point in 2D space) and an angle (in 
radians). The macro should return a new pair -- a point rotated by the given 
angle. The macro should use as much information as is available at the 
compile-time, e.g. if all numbers supplied are constant, then only the final 
result should be inlined, otherwise the result must be computed at runtime.
</p>
<a name="Adding_new_syntax_to_the_compiler"></a><h2> Adding new syntax to the compiler </h2>
<p>After we have written the <tt>for</tt> macro, we would like the compiler
to understand some changes to its syntax. Especially the C-like notation
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">mutable</span> i = <span style="color: rgb(255, 0, 0);">0</span>; i &lt; n; --i<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
  sum += i;
  <span style="color: rgb(0, 0, 0);">Nemerle</span>.IO.printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"%d<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span>, sum<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>In order to achieve that, we have to define which tokens and grammar
elements may form a call of <tt>for</tt> macro. We do that by changing
its header to
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> <span style="color: rgb(6, 0, 255);">for</span> <span style="color: rgb(0, 0, 0);">(</span>init, cond, change, body<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(6, 0, 255);">syntax</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"for"</span>, <span style="color: rgb(128, 128, 128);">"("</span>, init, <span style="color: rgb(128, 128, 128);">";"</span>, cond, <span style="color: rgb(128, 128, 128);">";"</span>, change, <span style="color: rgb(128, 128, 128);">")"</span>, body<span style="color: rgb(0, 0, 0);">)</span></pre>
<p>The <tt>syntax</tt> keyword is used here to define a list of elements forming
the syntax of the macro call. The first token must always be an unique identifier
(from now on it is treated as a special keyword triggering parsing of
defined sequence). It is followed by tokens composed of operators or
identifiers passed as string literals or names of parameters of macro.
Each parameter must occur exactly once.
</p><p>Parsing of syntax rule is straightforward - tokens from input
program must match those from definition, parameters are parsed
according to their type. Default type of a parameter is 
<tt>Expr</tt>, which is just an ordinary expression (consult Nemerle
grammar in <a href="http://wiki.nemerle.org/Reference" title="Reference">Reference</a>). All allowed parameter types 
will be described in the extended version of reference manual corresponding
to macros.
</p>
<a name="Exercise_3"></a><h3> Exercise </h3>
<p>Add a new syntactic construct <tt>forpermutation</tt> to your program.
It should be defined as the macro
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> forp <span style="color: rgb(0, 0, 0);">(</span>i, n&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>, m&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>, body<span style="color: rgb(0, 0, 0);">)</span></pre>
<p>and introduce syntax, which allows writing the following program
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">mutable</span> i = <span style="color: rgb(255, 0, 0);">0</span>;
forpermutation <span style="color: rgb(0, 0, 0);">(</span>i <span style="color: rgb(6, 0, 255);">in</span> <span style="color: rgb(255, 0, 0);">3</span> to <span style="color: rgb(255, 0, 0);">10</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.IO.printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"%d<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span>, i<span style="color: rgb(0, 0, 0);">)</span></pre>
<p>It should create a random permutation <tt>p</tt> of numbers 
<tt>x_j, m &lt;= x_j &lt;= n</tt> at the compile-time. 
Then generate the code executing body of the loop 
<tt>n - m + 1</tt> times, preceding each of them with assignment of 
permutation element to <tt>i</tt>.
</p>
<a name="Macros_in_custom_attributes"></a><h2> Macros in custom attributes </h2>
<a name="Executing_macros_on_type_declarations"></a><h3> Executing macros on type declarations </h3>
<p>Nemerle macros are simply plugins to the compiler. We decided
not to restrict them only to operations on expressions, but
allow them to transform almost any part of program. 
</p><p>Macros can be used within custom attributes written near methods, 
type declarations, method parameters, fields, etc. They are
executed with those entities passed as their parameters.
</p><p><br>
As an example, let us take a look at <tt>Serializable</tt> macro.
Its usage looks like this:
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(255, 0, 0);">class</span> S <span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span> <span style="color: rgb(0, 0, 0);">(</span>v&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>, m&nbsp;: S<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> a = v; my = m; <span style="color: rgb(0, 0, 0);">}</span>
  my&nbsp;: S;
  a&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>From now on, <tt>S</tt> has additional method <tt>Serialize</tt>
and it implements interface <tt>ISerializable</tt>. We can use
it in our code like this
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> s = S <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">4</span>, S <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">5</span>, <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
s.Serialize <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>And the output is
</p>
<pre class="xml"><span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;a<span style="font-weight: bold; color: black;">&gt;</span></span></span>4<span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;/a<span style="font-weight: bold; color: black;">&gt;</span></span></span>
<span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;my<span style="font-weight: bold; color: black;">&gt;</span></span></span>
  <span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;a<span style="font-weight: bold; color: black;">&gt;</span></span></span>5<span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;/a<span style="font-weight: bold; color: black;">&gt;</span></span></span>
  <span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;my<span style="font-weight: bold; color: black;">&gt;</span></span></span>
    <span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;null</span><span style="font-weight: bold; color: black;">/&gt;</span></span>
  <span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;/my<span style="font-weight: bold; color: black;">&gt;</span></span></span>
<span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;/my<span style="font-weight: bold; color: black;">&gt;</span></span></span></pre>
<p>The macro modifies type S at compile-time and adds some code to it. 
Also inheritance relation of given class is changed, by making it 
implement interface ISerializable
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">interface</span> ISerializable <span style="color: rgb(0, 0, 0);">{</span>
  Serialize <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<a name="Manipulating_type_declarations"></a><h3> Manipulating type declarations </h3>
<p>In general, macros placed in attributes can do many transformations 
and analysis of program objects passed to them. To see 
<tt>Serializable</tt> macro's internals and discuss some design 
issues, let's go into its code.
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroUsage <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroPhase.BeforeInheritance, <span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroTargets.<span style="color: rgb(255, 0, 0);">Class</span>,
                     Inherited = <span style="color: rgb(6, 0, 255);">true</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(6, 0, 255);">macro</span> Serializable <span style="color: rgb(0, 0, 0);">(</span>t&nbsp;: TypeBuilder<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  t.AddImplementedInterface <span style="color: rgb(0, 0, 0);">(</span>&lt;<span style="color: rgb(0, 0, 0);">[</span> ISerializable <span style="color: rgb(0, 0, 0);">]</span>&gt;<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>First we have to add interface, which given type is about to
implement. But more important thing is the phase modifier 
<tt>BeforeInheritance</tt> in macro's custom attribute. In general, 
we separate three <a href="#chunk-Macros_tutorial" title="Macros tutorial">stages of execution</a> for attribute macros.
<tt>BeforeInheritance</tt> specifies that the macro will be able to change 
subtyping information of the class it operates on.
</p><p>So, we have added interface to our type, we now have to create 
Serialize () method.
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroUsage <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroPhase.WithTypedMembers, <span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroTargets.<span style="color: rgb(255, 0, 0);">Class</span>,
                     Inherited = <span style="color: rgb(6, 0, 255);">true</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(6, 0, 255);">macro</span> Serializable <span style="color: rgb(0, 0, 0);">(</span>t&nbsp;: TypeBuilder<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">/// here we list its fields and choose only those, which are not derived</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">/// or static</span>
  <span style="color: rgb(6, 0, 255);">def</span> fields = t.GetFields <span style="color: rgb(0, 0, 0);">(</span>BindingFlags.Instance | BindingFlags.<span style="color: rgb(6, 0, 255);">Public</span> %|
                            BindingFlags.NonPublic | BindingFlags.DeclaredOnly<span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
  <span style="color: rgb(0, 128, 128); font-style: italic;">/// now create list of expressions which will print object's data  </span>
  <span style="color: rgb(6, 0, 255);">mutable</span> serializers = <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">]</span>;
&nbsp;
  <span style="color: rgb(0, 128, 128); font-style: italic;">/// traverse through fields, taking their type constructors  </span>
  <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>x&nbsp;: IField <span style="color: rgb(6, 0, 255);">in</span> fields<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(6, 0, 255);">def</span> tc = x.GetMemType <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>.TypeInfo;
    <span style="color: rgb(6, 0, 255);">def</span> nm = Macros.UseSiteSymbol <span style="color: rgb(0, 0, 0);">(</span>x.Name<span style="color: rgb(0, 0, 0);">)</span>;
    <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>tc&nbsp;!= <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span>
      <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>tc.IsValueType<span style="color: rgb(0, 0, 0);">)</span>
        <span style="color: rgb(0, 128, 128); font-style: italic;">/// we can safely print value types as strings        </span>
        serializers = &lt;<span style="color: rgb(0, 0, 0);">[</span>
                         printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"&lt;%s&gt;"</span>, $<span style="color: rgb(0, 0, 0);">(</span>x.Name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
                         <span style="color: rgb(0, 0, 0);">System</span>.Console.Write <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>nm&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
                         printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"&lt;/%s&gt;<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span>, $<span style="color: rgb(0, 0, 0);">(</span>x.Name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
                       <span style="color: rgb(0, 0, 0);">]</span>&gt;
                      &nbsp;:: serializers
      <span style="color: rgb(6, 0, 255);">else</span>
        <span style="color: rgb(0, 128, 128); font-style: italic;">/// we can try to check, if type of given field also implements ISerializable</span>
        <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>x.GetMemType <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>.Require <span style="color: rgb(0, 0, 0);">(</span>&lt;<span style="color: rgb(0, 0, 0);">[</span> ttype: ISerializable <span style="color: rgb(0, 0, 0);">]</span>&gt;<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>
          serializers = &lt;<span style="color: rgb(0, 0, 0);">[</span>
                           printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"&lt;%s&gt;<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span>, $<span style="color: rgb(0, 0, 0);">(</span>x.Name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;      
                           <span style="color: rgb(6, 0, 255);">if</span> <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>nm&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span>&nbsp;!= <span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span>
                             $<span style="color: rgb(0, 0, 0);">(</span>nm&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span>.Serialize <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
                           <span style="color: rgb(6, 0, 255);">else</span>
                             printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"&lt;null/&gt;<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span><span style="color: rgb(0, 0, 0);">)</span>;
                           printf <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"&lt;/%s&gt;<span style="color: rgb(0, 128, 128); font-weight: bold;">\n</span>"</span>, $<span style="color: rgb(0, 0, 0);">(</span>x.Name&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
                         <span style="color: rgb(0, 0, 0);">]</span>&gt;
                        &nbsp;:: serializers
        <span style="color: rgb(6, 0, 255);">else</span>
          <span style="color: rgb(0, 128, 128); font-style: italic;">/// and finally, we encounter case when there is no easy way to serialize </span>
          <span style="color: rgb(0, 128, 128); font-style: italic;">/// given field</span>
          Message.FatalError <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"field `"</span> + x.Name + <span style="color: rgb(128, 128, 128);">"' cannot be serialized"</span><span style="color: rgb(0, 0, 0);">)</span>
    <span style="color: rgb(6, 0, 255);">else</span>
      Message.FatalError <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"field `"</span> + x.Name + <span style="color: rgb(128, 128, 128);">"' cannot be serialized"</span><span style="color: rgb(0, 0, 0);">)</span>
  <span style="color: rgb(0, 0, 0);">}</span>;
  <span style="color: rgb(0, 128, 128); font-style: italic;">// after analyzing fields, we create method in our type, to execute created</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">// expressions</span>
  t.Define <span style="color: rgb(0, 0, 0);">(</span>&lt;<span style="color: rgb(0, 0, 0);">[</span> decl: <span style="color: rgb(6, 0, 255);">public</span> Serialize <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
                     implements ISerializable.Serialize <span style="color: rgb(0, 0, 0);">{</span>
                       .. $serializers
                     <span style="color: rgb(0, 0, 0);">}</span>
            <span style="color: rgb(0, 0, 0);">]</span>&gt;<span style="color: rgb(0, 0, 0);">)</span>;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><br>
</p>
<a name="Execution_stages"></a><h3> Execution stages </h3>
<p>Analysing object-oriented hierarchy and class members is a separate pass of the compilation. 
First it creates inheritance relation between classes, so we know exactly all base types of
given type. After that every member inside of them (methods, fields, etc.)
is being analysed and added to the hierarchy and its type annotations are resolved. 
After that also the rules regarding implemented interface methods are checked.
</p><p>For the needs of macros we have decided to distinguish three moments in
this pass at which they can operate on elements of class hierarchy.
Every macro can be annotated with a stage, at which it should be executed.
</p>
<ul><li><b>BeforeInheritance</b> stage is performed after parsing whole
program and scanning declared types, but before building subtyping
relation between them. It gives macro a freedom to change inheritance
hierarchy and operate on parse-tree of classes and members
</li><li><b>BeforeTypedMembers</b> is when inheritance of types is
already set. Macros can still operate on bare parse-trees, but utilize
information about subtyping.
</li><li><b>WithTypedMembers</b> stage is after headers of methods,
fields are already analysed and in bound state. Macros can easily
traverse entire class space by reflecting type constructors of fields,
method parameters, etc. Original parse-trees are no longer available
and signatures of class members cannot be changed.
</li></ul>
<a name="Parameters_of_attribute_macros"></a><h4> Parameters of attribute macros </h4>
<p>Every executed attribute macro operates on some element of class hierarchy, 
so it must be supplied with an additional parameter describing the object, on which macro was placed. 
This way it can easily query for properties of that element and use compiler's API to reflect or change the
context in which it was defined. 
</p><p>For example a method macro declaration would be
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroUsage <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroPhase.WithTypedMembers,
                     <span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroTargets.Method<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(6, 0, 255);">macro</span> MethodMacro <span style="color: rgb(0, 0, 0);">(</span>t&nbsp;: TypeBuilder, f&nbsp;: MethodBuilder, expr<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">// use 't' and 'f' to query or change class-level elements</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">// of program</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Macro is annotated with additional attributes specifying respectively the
stage in which macro will be executed and the macro target.
</p><p>The available parameters contain references to class hierarchy elements that given macro operates on. 
They are automatically supplied by compiler and they vary on the target and stage of given macro.
Here is a little table specifying valid parameters for each stage and target of attribute macro.
</p>
<table border="1" cellpadding="2">
<caption>Attribute macro targets and parameters
</caption>
<tbody><tr>
<th> MacroTarget </th><th> MacroPhase.BeforeInheritance </th><th> MacroPhase.BeforeTypedMembers </th><th> MacroPhase.WithTypedMembers
</th></tr>
<tr>
<th> Class
</th><td> TypeBuilder </td><td> TypeBuilder </td><td> TypeBuilder
</td></tr>
<tr>
<th> Method
</th><td> TypeBuilder, ParsedMethod </td><td> TypeBuilder, ParsedMethod </td><td> TypeBuilder, MethodBuilder
</td></tr>
<tr>
<th> Field
</th><td> TypeBuilder, ParsedField </td><td> TypeBuilder, ParsedField </td><td> TypeBuilder, FieldBuilder
</td></tr>
<tr>
<th> Property
</th><td> TypeBuilder, ParsedProperty </td><td> TypeBuilder, ParsedProperty </td><td> TypeBuilder, PropertyBuilder
</td></tr>
<tr>
<th> Event
</th><td> TypeBuilder, ParsedEvent </td><td> TypeBuilder, ParsedEvent </td><td> TypeBuilder, EventBuilder
</td></tr>
<tr>
<th> Parameter
</th><td> TypeBuilder, ParsedMethod, ParsedParameter </td><td> TypeBuilder, ParsedMethod, ParsedParameter </td><td> TypeBuilder, MethodBuilder, ParameterBuilder
</td></tr>
<tr>
<th> Assembly
</th><td> (none) </td><td> (none) </td><td> (none)
</td></tr></tbody></table>
<p>The intuition is that every macro has parameter holding its target
and additionally objects containing it (like TypeBuilder is available
in most of the attribute macros).
</p><p>After those implicitly available parameters there come standard
parameters explicitly supplied by user. They are the same as for
expression level macros.
</p>
<a name="Reference_to_more_advanced_aspects"></a><h2> Reference to more advanced aspects </h2>
<a name="Hygiene_and_alpha-renaming_of_identifiers"></a><h3> Hygiene and alpha-renaming of identifiers </h3>
<a name="Problem_with_names_capture"></a><h4> Problem with names capture </h4>
<p>Identifiers in quoted code (object code) must be treated
in a special way, because we usually do not know in which
scope they would appear. Especially they should not mix
with variables with the same names from the macro-use site.
</p><p><br>
Consider the following macro defining a local function <tt>f</tt>
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> identity <span style="color: rgb(0, 0, 0);">(</span>e<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> f <span style="color: rgb(0, 0, 0);">(</span>x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> x <span style="color: rgb(0, 0, 0);">}</span>; f<span style="color: rgb(0, 0, 0);">(</span>$e<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">]</span>&gt; <span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Calling it with <tt>identity (f(1))</tt> might generate 
confusing code like
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> f <span style="color: rgb(0, 0, 0);">(</span>x<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> x <span style="color: rgb(0, 0, 0);">}</span>; f <span style="color: rgb(0, 0, 0);">(</span>f <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span></pre>
<p>To preserve names capture, all macro generated variables 
should be renamed to their unique counterparts, like in
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> f_<span style="color: rgb(255, 0, 0);">42</span> <span style="color: rgb(0, 0, 0);">(</span>x_<span style="color: rgb(255, 0, 0);">43</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">{</span> x_<span style="color: rgb(255, 0, 0);">43</span> <span style="color: rgb(0, 0, 0);">}</span>; f_<span style="color: rgb(255, 0, 0);">42</span> <span style="color: rgb(0, 0, 0);">(</span>f <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span></pre>
<a name="Hygiene_of_macros"></a><h4> Hygiene of macros </h4>
<p>The idea of separating variables introduced by a macro from 
those defined in the plain code (or other macros) is called 
`hygiene' after Lisp and Scheme languages. In Nemerle 
we define it as putting identifiers created during a single 
macro execution into a unique namespace. Variables from
different namespaces cannot bind to each other.
</p><p><br>
In other words, a macro cannot create identifiers capturing
any external variables or visible outside of its own 
generated code. This means, that there is no need to care
about locally used names.
</p><p><br>
The Hygiene is obtained by encapsulating identifiers in special
<tt>Name</tt> class. The compiler uses it to distinguish names
from different macro executions and scopes (for details of
implementation consult <a href="http://nemerle.org/metaprogramming.pdf" class="external text" title="http://nemerle.org/metaprogramming.pdf">paper about macros</a>).
Variables with appropriate information are created 
automatically by quotation.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> definition = &lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> y = <span style="color: rgb(255, 0, 0);">4</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;;
&lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> x = <span style="color: rgb(255, 0, 0);">5</span>; $definition; x + y <span style="color: rgb(0, 0, 0);">]</span>&gt;</pre>
<p>When a macro creates the above code, identifiers <tt>y</tt> and 
<tt>x</tt> are tagged with the same unique mark. Now they
cannot be captured by any external variables (with a 
different mark). We operate on the <tt>Name</tt> class, when the
quoted code is composed or decomposed and we use 
<tt>&lt;[ $(x&nbsp;: name) ]&gt;</tt> construct. Here <tt>x</tt> 
is bound to am object of type <tt>Name</tt>, which we can use
in other place to create exactly the same identifier.
</p><p>An identifier can be also created by calling method
<tt>Macros.NewSymbol()</tt>, which returns <tt>Name</tt>
with an unique identifier, tagged with a current mark.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> x = Macros.NewSymbol <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&lt;<span style="color: rgb(0, 0, 0);">[</span> <span style="color: rgb(6, 0, 255);">def</span> $<span style="color: rgb(0, 0, 0);">(</span>x&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span> = <span style="color: rgb(255, 0, 0);">5</span>; $<span style="color: rgb(0, 0, 0);">(</span>x&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span> + <span style="color: rgb(255, 0, 0);">4</span> <span style="color: rgb(0, 0, 0);">]</span>&gt;</pre>
<a name="Controlled_breaking_hygiene"></a><h4> Controlled breaking hygiene </h4>
<p>Sometimes it is useful to generate identifiers, which
bind to variables visible in place where a macro is used. For example
one of macro's parameters is a string with some identifiers inside. If
we want to use these as real identifiers, then we need to break
automatic hygiene. It is especially useful
in embedding domain-specific languages, which reference symbols from
the original program.
</p><p>As an example consider a <tt>Nemerle.IO.sprint (string literal)</tt> macro (which have the syntax shortcut <tt>$"some text $id "</tt>).
It searches given string literal for <i>$var</i> and creates a code concatenating text before and after <i>$var</i> to the value of <tt>var.ToString ()</tt>.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> x = <span style="color: rgb(255, 0, 0);">3</span>;
<span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(128, 128, 128);">"My value of x is $x and I'm happy"</span><span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>expands to
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">def</span> x = <span style="color: rgb(255, 0, 0);">3</span>;
<span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">{</span> 
  <span style="color: rgb(6, 0, 255);">def</span> sb = <span style="color: rgb(0, 0, 0);">System</span>.Text.StringBuilder <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"My value of x is "</span><span style="color: rgb(0, 0, 0);">)</span>; 
  sb.Append <span style="color: rgb(0, 0, 0);">(</span>x.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>; 
  sb.Append <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">" and I'm happy"</span><span style="color: rgb(0, 0, 0);">)</span>; 
  sb.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> 
<span style="color: rgb(0, 0, 0);">}</span><span style="color: rgb(0, 0, 0);">)</span>;</pre>
<p>Breaking of hygiene is necessary here, because we generate code (reference to <i>x</i>), which need to have the
same context as variables from invocation place of macro.
</p><p>To make given name bind to the symbols from macro usesite, we use <tt>Nemerle.Macros.UseSiteSymbol (name&nbsp;: string)&nbsp;: Name</tt> function, or
special splicing target <i>usesite</i> in quotations. Their use would be like in this simplified implementation of macro
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">macro</span> sprint <span style="color: rgb(0, 0, 0);">(</span>lit&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span> 
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(6, 0, 255);">def</span> <span style="color: rgb(0, 0, 0);">(</span>prefix, symbol, suffix<span style="color: rgb(0, 0, 0);">)</span> = Helper.ExtractDollars <span style="color: rgb(0, 0, 0);">(</span>lit<span style="color: rgb(0, 0, 0);">)</span>;
  <span style="color: rgb(6, 0, 255);">def</span> varname = <span style="color: rgb(0, 0, 0);">Nemerle</span>.Macros.UseSiteSymbol <span style="color: rgb(0, 0, 0);">(</span>symbol<span style="color: rgb(0, 0, 0);">)</span>;
  &lt;<span style="color: rgb(0, 0, 0);">[</span> 
    <span style="color: rgb(6, 0, 255);">def</span> sb = <span style="color: rgb(0, 0, 0);">System</span>.Text.StringBuilder <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>prefix&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>; 
    sb.Append <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>varname&nbsp;: name<span style="color: rgb(0, 0, 0);">)</span>.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>; 
    <span style="color: rgb(0, 128, 128); font-style: italic;">// or alternatively  $(symbol&nbsp;: usesite)</span>
    sb.Append <span style="color: rgb(0, 0, 0);">(</span>$<span style="color: rgb(0, 0, 0);">(</span>suffix&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>; 
    sb.ToString <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> 
  <span style="color: rgb(0, 0, 0);">]</span>&gt;
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Note that this operations is 'safe', that is it changes context of variable to the place where macro invocation was created 
(see paper for more details).
</p>
<a name="Unhygienic_variables"></a><h4> Unhygienic variables </h4>
<p>Sometimes it is useful to completely break hygiene, where programmer
only want to experiment with new ideas. From our experience, it is often
hard to reason about correct contexts for variables, especially when
writing class level macros. In this
case it is useful to be able to easily break hygine. 
</p><p>Nemerle provides it with <i>&lt;[ $("id"&nbsp;: dyn) ]&gt;</i> construct. It makes produced variable break hygiene rules and always
bind to the nearest definition with the same name.
</p>
<!-- Saved in parser cache with key wiki:pcache:idhash:988-0!1!0!0!!en!2 and timestamp 20060121083519 -->
<a name="chunk-ASP.NET_(tutorial)"></a>
	  	  <h1 class="firstHeading">ASP.NET (tutorial)</h1>
	    	    	    <!-- start content -->
	    <a name="Preparations"></a><h2> Preparations </h2>
<p>In order to use Nemerle in your <a href="http://asp.net/" class="external text" title="http://asp.net">ASP.NET</a> pages you first need to add following line
</p>
<pre class="xml"><span style="color: rgb(0, 153, 0);"><span style="font-weight: bold; color: black;">&lt;compiler</span> <span style="color: rgb(0, 0, 102);">language</span>=<span style="color: rgb(255, 0, 0);">"n;nemerle;Nemerle"</span> <span style="color: rgb(0, 0, 102);">extension</span>=<span style="color: rgb(255, 0, 0);">".n"</span> <span style="color: rgb(0, 0, 102);">warningLevel</span>=<span style="color: rgb(255, 0, 0);">"1"</span>  <span style="color: rgb(0, 0, 102);">compilerOptions</span>=<span style="color: rgb(255, 0, 0);">""</span>                        
   <span style="color: rgb(0, 0, 102);">type</span>=<span style="color: rgb(255, 0, 0);">"Nemerle.Compiler.NemerleCodeProvider, Nemerle.Compiler, Version=0.9.1.0, Culture=neutral, PublicKeyToken=5291d186334f6101"</span> 
  <span style="font-weight: bold; color: black;">/&gt;</span></span></pre>
<p>in &lt;configuration&gt;&lt;system.web&gt;&lt;compilation&gt;...
to your <i>machine.config</i> file (tested on mono, where this file can be found in /etc/mono/2.0/, you will need to use XSP2)
</p><p>You may need to change the version. (Check ncc --version).
</p>
<a name="Example_page"></a><h2> Example page </h2>
<p>Now you can create <i>test.aspx</i> with following content:
</p>
<pre class="asp"><span style="color: rgb(0, 0, 255); font-weight: bold;">&lt;%</span>@ language=Nemerle <span style="color: rgb(0, 0, 255); font-weight: bold;">%&gt;</span>
&nbsp;
  &lt;script runat=<span style="color: rgb(204, 0, 0);">"server"</span>&gt;
    Page_Load<span style="color: rgb(0, 102, 0); font-weight: bold;">(</span>_&nbsp;: object, _&nbsp;: EventArgs<span style="color: rgb(0, 102, 0); font-weight: bold;">)</span>&nbsp;: void <span style="color: rgb(0, 102, 0); font-weight: bold;">{</span>
      Message.<span style="color: rgb(153, 0, 204);">Text</span> = $<span style="color: rgb(204, 0, 0);">"You last accessed this page at: $(DateTime.Now)"</span>;
    <span style="color: rgb(0, 102, 0); font-weight: bold;">}</span>
&nbsp;
    EnterBtn_Click<span style="color: rgb(0, 102, 0); font-weight: bold;">(</span>_&nbsp;: object, _&nbsp;: EventArgs<span style="color: rgb(0, 102, 0); font-weight: bold;">)</span>&nbsp;: void 
    <span style="color: rgb(0, 102, 0); font-weight: bold;">{</span>
      Message.<span style="color: rgb(153, 0, 204);">Text</span> = $<span style="color: rgb(204, 0, 0);">"Hi $(Name.Text), welcome to ASP.NET!"</span>;
    <span style="color: rgb(0, 102, 0); font-weight: bold;">}</span>
  <span style="color: rgb(0, 0, 255); font-weight: bold;">&lt;/script&gt;</span>
&nbsp;
&lt;html&gt;
      &lt;form runat=server&gt;
&nbsp;
          &lt;font face=<span style="color: rgb(204, 0, 0);">"Verdana"</span>&gt; 
&nbsp;
             Please enter your name: &lt;asp:textbox id=<span style="color: rgb(204, 0, 0);">"Name"</span> runat=<span style="color: rgb(153, 0, 153); font-weight: bold;">server</span>/&gt; 
                                     &lt;asp:button id=<span style="color: rgb(204, 0, 0);">"EnterBtn"</span> text=<span style="color: rgb(204, 0, 0);">"Enter"</span> Onclick=<span style="color: rgb(204, 0, 0);">"EnterBtn_Click"</span> runat=<span style="color: rgb(153, 0, 153); font-weight: bold;">server</span>/&gt;
&nbsp;
             &lt;p&gt;
               &lt;asp:label id=<span style="color: rgb(204, 0, 0);">"Message"</span>  runat=<span style="color: rgb(153, 0, 153); font-weight: bold;">server</span>/&gt;
             &lt;/p&gt;
&nbsp;
          &lt;/font&gt;
&nbsp;
       &lt;/form&gt;
&lt;/html&gt;</pre>
<p>And everything should work fine. This scenario was tested with xsp
and mod_mono on mono 1.1.6, please let us know how it works on MS.NET +
ISS.
</p><p><br>Using a separate file for code is also possible and may be
preferable in larger examples. This may be done by creating a file
test.n for the code.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Web.UI;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Web.UI.WebControls;
&nbsp;
<span style="color: rgb(6, 0, 255);">public</span> partial <span style="color: rgb(255, 0, 0);">class</span> Test&nbsp;: Page
<span style="color: rgb(0, 0, 0);">{</span>
   <span style="color: rgb(6, 0, 255);">protected</span> Page_Load<span style="color: rgb(0, 0, 0);">(</span>_&nbsp;: <span style="color: rgb(255, 0, 0);">object</span>, _&nbsp;: EventArgs<span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     Message.Text = $<span style="color: rgb(128, 128, 128);">"You last accessed this page at: $(DateTime.Now)"</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
   <span style="color: rgb(6, 0, 255);">protected</span> EnterBtn_Click<span style="color: rgb(0, 0, 0);">(</span>_&nbsp;: <span style="color: rgb(255, 0, 0);">object</span>, _&nbsp;: EventArgs<span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
   <span style="color: rgb(0, 0, 0);">{</span>
     Message.Text = $<span style="color: rgb(128, 128, 128);">"Hi $(Name.Text), welcome to ASP.NET!"</span>;
   <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>and then removing the script section of test.aspx and replacing the top line with
</p>
<pre class="asp"><span style="color: rgb(0, 0, 255); font-weight: bold;">&lt;%</span>@ language=Nemerle codefile=<span style="color: rgb(204, 0, 0);">"test.n"</span> inherits=<span style="color: rgb(204, 0, 0);">"Test"</span> <span style="color: rgb(0, 0, 255); font-weight: bold;">%&gt;</span></pre>

<!-- Saved in parser cache with key wiki:pcache:idhash:744-0!1!0!0!!en!2 and timestamp 20060120213759 -->
<a name="chunk-Remoting_(tutorial)"></a>
	  	  <h1 class="firstHeading">Remoting (tutorial)</h1>
	    	    	    <!-- start content -->
	    <p>This
is a simple example that shows how to realize remoting in Nemerle.
Essentially this is translation of the example presented in the <a href="http://monohandbook.monoforge.com/monkeyguide/remoting/introduction.html" class="external text" title="http://monohandbook.monoforge.com/monkeyguide/remoting/introduction.html">MonoHandbook</a>.
</p><p><br>
Remoting allow clients to access objects in the server. And thus it is a good abstraction to distribute computing.
</p><p>In this example both Server and Client share the definition of
ServerObjects. The server program opens a port for conection and
publish a ServerObject. Later the client program connects himself to
the server port and access, remotely, the published objects and their
methods. </p><p>The example shows the basic remoting usage, managing objects by reference and by value (through serialization).
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Client"><span class="tocnumber">1</span> <span class="toctext">Client</span></a></li>
<li class="toclevel-1"><a href="#Server"><span class="tocnumber">2</span> <span class="toctext">Server</span></a></li>
<li class="toclevel-1"><a href="#ServerObjects"><span class="tocnumber">3</span> <span class="toctext">ServerObjects</span></a></li>
<li class="toclevel-1"><a href="#Compilation"><span class="tocnumber">4</span> <span class="toctext">Compilation</span></a></li>
<li class="toclevel-1"><a href="#Serializing_Variants"><span class="tocnumber">5</span> <span class="toctext">Serializing Variants</span></a>
<ul>
<li class="toclevel-2"><a href="#Using_a_macro_to_mark_all_options_with_attribute"><span class="tocnumber">5.1</span> <span class="toctext">Using a macro to mark all options with attribute</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Client"></a><h2> Client </h2>
<p>Save the following code in the file "Client.n".
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Net;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting.Channels;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting.Channels.Tcp;
&nbsp;
<span style="color: rgb(6, 0, 255);">namespace</span> RemotingTest
<span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(255, 0, 0);">class</span> RemotingClient
    <span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(6, 0, 255);">def</span> ch = TcpChannel <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)</span>;
            ChannelServices.RegisterChannel <span style="color: rgb(0, 0, 0);">(</span>ch<span style="color: rgb(0, 0, 0);">)</span>;
            
            <span style="color: rgb(0, 128, 128); font-style: italic;">// This gets the object from the server (a list of ServerObject)</span>
&nbsp;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Getting instance ..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> remOb = Activator.GetObject <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">typeof</span> <span style="color: rgb(0, 0, 0);">(</span>ServerList<span style="color: rgb(0, 0, 0);">)</span>,
                                             <span style="color: rgb(128, 128, 128);">"tcp://localhost:1122/test.rem"</span><span style="color: rgb(0, 0, 0);">)</span>;
                                             
            <span style="color: rgb(6, 0, 255);">def</span> list = remOb&nbsp;:&gt;ServerList;
            
            <span style="color: rgb(0, 128, 128); font-style: italic;">// These are remote calls that return references to remote objects</span>
&nbsp;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Creating two remote items..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> item1 = list.NewItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Created at server 1"</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:ServerObject;
            item1.SetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">111</span><span style="color: rgb(0, 0, 0);">)</span>; <span style="color: rgb(0, 128, 128); font-style: italic;">// another call made to the remote object</span>
            <span style="color: rgb(6, 0, 255);">def</span> item2 = list.NewItem <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Created at server 2"</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:ServerObject;
            item2.SetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">222</span><span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
&nbsp;
            <span style="color: rgb(0, 128, 128); font-style: italic;">// Two objects created in this client app</span>
            
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Creating two client items..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> item3 = ServerObject <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Created at client 1"</span><span style="color: rgb(0, 0, 0);">)</span>;
            item3.SetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">333</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> item4 = ServerObject <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Created at client 2"</span><span style="color: rgb(0, 0, 0);">)</span>;
            item4.SetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">444</span><span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
            <span style="color: rgb(0, 128, 128); font-style: italic;">// Object references passed to the remote list</span>
            
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Adding items..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            list.Add <span style="color: rgb(0, 0, 0);">(</span>item3<span style="color: rgb(0, 0, 0);">)</span>;
            list.Add <span style="color: rgb(0, 0, 0);">(</span>item4<span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
&nbsp;
            <span style="color: rgb(0, 128, 128); font-style: italic;">// This sums all values of the ServerObjects in the list. The server</span>
	    <span style="color: rgb(0, 128, 128); font-style: italic;">// makes a remote call to this client to get the value of the</span>
	    <span style="color: rgb(0, 128, 128); font-style: italic;">// objects created locally</span>
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Processing items..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            list.ProcessItems <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            
            <span style="color: rgb(0, 128, 128); font-style: italic;">// Passing some complex info as parameter and return value</span>
            
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Setting complex data..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> cd = ComplexData <span style="color: rgb(0, 0, 0);">(</span>AnEnum.D, <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(128, 128, 128);">"some"</span>&nbsp;:<span style="color: rgb(255, 0, 0);">object</span>, <span style="color: rgb(255, 0, 0);">22</span>, <span style="color: rgb(128, 128, 128);">"info"</span><span style="color: rgb(0, 0, 0);">]</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> res = list.SetComplexData <span style="color: rgb(0, 0, 0);">(</span>cd<span style="color: rgb(0, 0, 0);">)</span>&nbsp;:ComplexData;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"This is the result:"</span><span style="color: rgb(0, 0, 0);">)</span>;
            res.Dump <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
            list.Clear <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Done."</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
            ch.StopListening <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span>;
&nbsp;
        <span style="color: rgb(0, 0, 0);">}</span>
    <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<a name="Server"></a><h2> Server </h2>
<p>Save the following code in the file "Server.n".
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting.Channels;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting.Channels.Tcp;
&nbsp;
<span style="color: rgb(6, 0, 255);">namespace</span> RemotingTest
<span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> RemotingServer
    <span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(6, 0, 255);">static</span> Main <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(255, 0, 0);">int</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Starting Server"</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">def</span> ch = TcpChannel <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(255, 0, 0);">1122</span><span style="color: rgb(0, 0, 0);">)</span>;
            ChannelServices.RegisterChannel <span style="color: rgb(0, 0, 0);">(</span>ch<span style="color: rgb(0, 0, 0);">)</span>;
            
            <span style="color: rgb(6, 0, 255);">def</span> ser = ServerList <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            _ = RemotingServices.Marshal <span style="color: rgb(0, 0, 0);">(</span>ser, <span style="color: rgb(128, 128, 128);">"test.rem"</span><span style="color: rgb(0, 0, 0);">)</span>;
            
            Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Server Running ..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            _ = Console.ReadLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            
            ch.StopListening <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(6, 0, 255);">null</span><span style="color: rgb(0, 0, 0);">)</span>;
            
            <span style="color: rgb(255, 0, 0);">0</span>;
        <span style="color: rgb(0, 0, 0);">}</span>
    <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<a name="ServerObjects"></a><h2> ServerObjects </h2>
<p>Save the following code in the file "ServerObjects.n".
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.Remoting;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Collections;
&nbsp;
<span style="color: rgb(6, 0, 255);">namespace</span> RemotingTest
<span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(0, 128, 128); font-style: italic;">// A list of ServerObject instances</span>
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> ServerList&nbsp;:MarshalByRefObject
    <span style="color: rgb(0, 0, 0);">{</span>
        values&nbsp;: ArrayList;
        
        <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span> <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            values = ArrayList <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
        <span style="color: rgb(0, 0, 0);">}</span>
        
        <span style="color: rgb(6, 0, 255);">public</span> Add <span style="color: rgb(0, 0, 0);">(</span>v&nbsp;:ServerObject<span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            _ = values.Add <span style="color: rgb(0, 0, 0);">(</span>v<span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Added "</span> + v.Name<span style="color: rgb(0, 0, 0);">)</span>;
            
        <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> ProcessItems <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Processing..."</span><span style="color: rgb(0, 0, 0);">)</span>;
            
            <span style="color: rgb(6, 0, 255);">mutable</span> total = <span style="color: rgb(255, 0, 0);">0</span>;
            <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>ob <span style="color: rgb(6, 0, 255);">in</span> values<span style="color: rgb(0, 0, 0);">)</span> total += <span style="color: rgb(0, 0, 0);">(</span>ob&nbsp;:&gt; ServerObject<span style="color: rgb(0, 0, 0);">)</span>.GetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
           
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Total: "</span> + total.ToString<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
        <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> Clear <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            values.Clear <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
        <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span>  NewItem <span style="color: rgb(0, 0, 0);">(</span>name&nbsp;:<span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:ServerObject
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(6, 0, 255);">def</span> obj = ServerObject <span style="color: rgb(0, 0, 0);">(</span>name<span style="color: rgb(0, 0, 0);">)</span>;
            Add <span style="color: rgb(0, 0, 0);">(</span>obj<span style="color: rgb(0, 0, 0);">)</span>;
            obj;
        <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> SetComplexData <span style="color: rgb(0, 0, 0);">(</span>data&nbsp;:ComplexData<span style="color: rgb(0, 0, 0);">)</span>&nbsp;:ComplexData 
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Showing content of ComplexData"</span><span style="color: rgb(0, 0, 0);">)</span>;
            data.Dump <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
            data;
        <span style="color: rgb(0, 0, 0);">}</span>
    <span style="color: rgb(0, 0, 0);">}</span>
    
&nbsp;
    <span style="color: rgb(0, 128, 128); font-style: italic;">// A remotable object</span>
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> ServerObject&nbsp;:MarshalByRefObject
    <span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(6, 0, 255);">mutable</span> _value&nbsp;:<span style="color: rgb(255, 0, 0);">int</span>;
        _name&nbsp;:<span style="color: rgb(255, 0, 0);">string</span>;
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span> <span style="color: rgb(0, 0, 0);">(</span>name&nbsp;:<span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            _name = name;
        <span style="color: rgb(0, 0, 0);">}</span>
        
        <span style="color: rgb(6, 0, 255);">public</span> Name&nbsp;:<span style="color: rgb(255, 0, 0);">string</span> 
        <span style="color: rgb(0, 0, 0);">{</span>
            get <span style="color: rgb(0, 0, 0);">{</span> _name; <span style="color: rgb(0, 0, 0);">}</span>
        <span style="color: rgb(0, 0, 0);">}</span>
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> SetValue <span style="color: rgb(0, 0, 0);">(</span>v&nbsp;:<span style="color: rgb(255, 0, 0);">int</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"ServerObject "</span> + _name + <span style="color: rgb(128, 128, 128);">": setting "</span> + v.ToString<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">)</span>;
            _value = v;
        <span style="color: rgb(0, 0, 0);">}</span>
        
        <span style="color: rgb(6, 0, 255);">public</span> GetValue <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(255, 0, 0);">int</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"ServerObject "</span> + _name + <span style="color: rgb(128, 128, 128);">": getting "</span> + _value.ToString<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
            _value;
        <span style="color: rgb(0, 0, 0);">}</span>
    <span style="color: rgb(0, 0, 0);">}</span>
    
&nbsp;
&nbsp;
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">enum</span> AnEnum <span style="color: rgb(0, 0, 0);">{</span> |A |B |C |D |E <span style="color: rgb(0, 0, 0);">}</span>;
&nbsp;
    <span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> 
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(255, 0, 0);">class</span> ComplexData
    <span style="color: rgb(0, 0, 0);">{</span>
        <span style="color: rgb(6, 0, 255);">public</span> Val&nbsp;:AnEnum;
        <span style="color: rgb(6, 0, 255);">public</span> Info&nbsp;: <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">object</span><span style="color: rgb(0, 0, 0);">]</span>;
&nbsp;
        <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">this</span> <span style="color: rgb(0, 0, 0);">(</span> va:AnEnum, info&nbsp;: <span style="color: rgb(6, 0, 255);">array</span> <span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">object</span><span style="color: rgb(0, 0, 0);">]</span><span style="color: rgb(0, 0, 0);">)</span> 
        <span style="color: rgb(0, 0, 0);">{</span>
            Info = info;
            Val = va;
        <span style="color: rgb(0, 0, 0);">}</span>
        
        <span style="color: rgb(6, 0, 255);">public</span>  Dump <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;:<span style="color: rgb(6, 0, 255);">void</span>
        <span style="color: rgb(0, 0, 0);">{</span>
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Content:"</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Val: "</span> + Val.ToString<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
            <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>ob <span style="color: rgb(6, 0, 255);">in</span> Info<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(0, 0, 0);">System</span>.Console.WriteLine <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Array item: "</span> + ob.ToString<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>;
        <span style="color: rgb(0, 0, 0);">}</span>
    <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<a name="Compilation"></a><h2> Compilation </h2>
<p>Save the following code in the file "Makefile".
</p>
<pre class="bash">all:
	ncc -t:library ServerObjects.n -o ServerObjects.dll
	ncc -r:ServerObjects.dll -r:System.Runtime.Remoting.dll Client.n -o Client.exe
	ncc -r:ServerObjects.dll -r:System.Runtime.Remoting.dll Server.n -o Server.exe</pre>
<p>Run "make" to compile the programs. Then execute the "Server.exe" in a console and "Client.exe" in another one.
</p>
<a name="Serializing_Variants"></a><h2> Serializing Variants </h2>
<p>By default custom attribues on <b>variant</b>s are not passed to its variant options. 
</p><p>Thus using
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> 
<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">variant</span> AnEnum <span style="color: rgb(0, 0, 0);">{</span> |A |B |C |D |E <span style="color: rgb(0, 0, 0);">}</span>;</pre>
<p>instead of the proposed enum (which is directly serializable) will create an <tt>System.Runtime.Serialization.SerializationException</tt> error - you must explicitly declare each element of the variant as <tt>Serializable</tt>.
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> 
<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">variant</span> AnEnum <span style="color: rgb(0, 0, 0);">{</span> 
	<span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> | A 
	<span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> | B 
	<span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> | C <span style="color: rgb(0, 0, 0);">{</span> x&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>; <span style="color: rgb(0, 0, 0);">}</span>
	<span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> | D <span style="color: rgb(0, 0, 0);">{</span> x&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>; <span style="color: rgb(0, 0, 0);">}</span>
	<span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> | E 
<span style="color: rgb(0, 0, 0);">}</span>;</pre>
<a name="Using_a_macro_to_mark_all_options_with_attribute"></a><h3> Using a macro to mark all options with attribute </h3>
<p>It is possible to use a macro <tt>Nemerle.MarkOptions</tt> to realize this in a compact way. 
For a little insight of how it works, there is its a full source, which fortunately is short.
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Compiler;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">Nemerle</span>.Compiler.Parsetree;
&nbsp;
<span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroUsage <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroPhase.BeforeInheritance,
                     <span style="color: rgb(0, 0, 0);">Nemerle</span>.MacroTargets.<span style="color: rgb(255, 0, 0);">Class</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(6, 0, 255);">macro</span> MarkOptions <span style="color: rgb(0, 0, 0);">(</span>t&nbsp;: TypeBuilder, attribute<span style="color: rgb(0, 0, 0);">)</span>
<span style="color: rgb(0, 0, 0);">{</span>
  <span style="color: rgb(0, 128, 128); font-style: italic;">// iterate through members of this type and select only variant options</span>
  <span style="color: rgb(6, 0, 255);">foreach</span> <span style="color: rgb(0, 0, 0);">(</span>ClassMember.TypeDeclaration
            <span style="color: rgb(0, 0, 0);">(</span>TopDeclaration.VariantOption <span style="color: rgb(6, 0, 255);">as</span> vo<span style="color: rgb(0, 0, 0);">)</span> <span style="color: rgb(6, 0, 255);">in</span> t.GetParsedMembers <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">)</span>
  <span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(0, 128, 128); font-style: italic;">// add given custom attribute to this variant option</span>
    vo.AddCustomAttribute <span style="color: rgb(0, 0, 0);">(</span>attribute<span style="color: rgb(0, 0, 0);">)</span>
  <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>Now you can use
</p>
<pre class="nemerle"><span style="color: rgb(0, 0, 0);">[</span>Serializable<span style="color: rgb(0, 0, 0);">]</span> 
<span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">Nemerle</span>.MarkOptions <span style="color: rgb(0, 0, 0);">(</span>Serializable<span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
<span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">variant</span> AnEnum <span style="color: rgb(0, 0, 0);">{</span> 
	| A 
	| B 
	| C <span style="color: rgb(0, 0, 0);">{</span> x&nbsp;: <span style="color: rgb(255, 0, 0);">string</span>; <span style="color: rgb(0, 0, 0);">}</span>
	| D <span style="color: rgb(0, 0, 0);">{</span> y&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>; <span style="color: rgb(0, 0, 0);">}</span>
	| E 
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p><b>Side note</b>
Remember that if you use variant instead of enum, the expression 
</p>
<pre class="nemerle">AnEnum.B</pre> 
<p>has to be changed to 
</p>
<pre class="nemerle">AnEnum.B <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span></pre>
This is for keeping consistency with <pre class="nemerle">AnEnum.C <span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Ala"</span><span style="color: rgb(0, 0, 0);">)</span></pre>

<!-- Saved in parser cache with key wiki:pcache:idhash:1008-0!1!0!0!!en!2 and timestamp 20060121191610 -->
<a name="chunk-PInvoke_(tutorial)"></a>
	  	  <h1 class="firstHeading">PInvoke (tutorial)</h1>
	    	    	    <!-- start content -->
	    <p>You
can take advantage of native platform libraries from within Nemerle
programs. The syntax is very similar to C#'s and other .NET languages.
Here is the simplest examlple:
</p>
<pre class="nemerle"><span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>;
<span style="color: rgb(6, 0, 255);">using</span> <span style="color: rgb(0, 0, 0);">System</span>.Runtime.InteropServices;
&nbsp;
<span style="color: rgb(255, 0, 0);">class</span> PlatformInvokeTest
<span style="color: rgb(0, 0, 0);">{</span>
    <span style="color: rgb(0, 0, 0);">[</span>DllImport<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"msvcrt.dll"</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
    <span style="color: rgb(6, 0, 255);">public</span> extern <span style="color: rgb(6, 0, 255);">static</span> puts<span style="color: rgb(0, 0, 0);">(</span>c&nbsp;: <span style="color: rgb(255, 0, 0);">string</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>;
&nbsp;
    <span style="color: rgb(0, 0, 0);">[</span>DllImport<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"msvcrt.dll"</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">]</span>
    <span style="color: rgb(6, 0, 255);">internal</span> extern <span style="color: rgb(6, 0, 255);">static</span> _flushall<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(255, 0, 0);">int</span>;
    
    <span style="color: rgb(6, 0, 255);">public</span> <span style="color: rgb(6, 0, 255);">static</span> Main<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>&nbsp;: <span style="color: rgb(6, 0, 255);">void</span>
    <span style="color: rgb(0, 0, 0);">{</span>
        _ = puts<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 128, 128);">"Test"</span><span style="color: rgb(0, 0, 0);">)</span>;
        _ = _flushall<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">)</span>;
    <span style="color: rgb(0, 0, 0);">}</span>
<span style="color: rgb(0, 0, 0);">}</span></pre>
<p>As you can see we use <i>DllImport</i> attribute, which comes from <i>System.Runtime.InteropServices</i> namespace. Every method marked with this attribute should also have <b>extern</b>
modifier. The concept is that the implementation of given method is
substituted by call to unmanaged method from library specified inside <i>DllImport</i> attribute.
</p><p>So, in above example, during execution of <i>Main</i> method first the <i>puts</i> function from <i>msvcrt.dll</i> will be called (printing a text to the standard output) and after that <i>_flushall</i> (making sure that all contents of buffer are printed).
</p><p>For more see <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/csref/html/vcwlkplatforminvoketutorial.asp" class="external text" title="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/csref/html/vcwlkplatforminvoketutorial.asp">P/Invoke tutorial</a> from MSDN.
</p>
<!-- Saved in parser cache with key wiki:pcache:idhash:1015-0!1!0!0!!en!2 and timestamp 20060120203710 -->
<a name="chunk-Category:Tutorials"></a>
	  	  <h1 class="firstHeading">Category:Tutorials</h1>
	    	    	    <!-- start content -->
	    
<!-- Saved in parser cache with key wiki:pcache:idhash:1541-0!1!0!0!!en!2 and timestamp 20060121191615 -->
<br style="clear: both;">
<h2>Articles in category "Tutorials"</h2>
There are 9 articles in this category.<ul><li><a href="#chunk-ASP.NET_%28tutorial%29" title="ASP.NET (tutorial)">ASP.NET (tutorial)</a></li></ul><h3>B</h3>
<ul><li><a href="http://wiki.nemerle.org/Beers_on_the_wall" title="Beers on the wall">Beers on the wall</a></li></ul><h3>F</h3>
<ul><li><a href="#chunk-First_Tutorial" title="First Tutorial">First Tutorial</a></li></ul><h3>G</h3>
<ul><li><a href="#chunk-Gtk_text_editor_%28tutorial%29" title="Gtk text editor (tutorial)">Gtk text editor (tutorial)</a></li></ul><h3>P</h3>
<ul><li><a href="#chunk-PInvoke_%28tutorial%29" title="PInvoke (tutorial)">PInvoke (tutorial)</a></li></ul><h3>R</h3>
<ul><li><a href="#chunk-Remoting_%28tutorial%29" title="Remoting (tutorial)">Remoting (tutorial)</a></li></ul><h3>S</h3>
<ul><li><a href="#chunk-System.Windows.Forms_tutorial" title="Second Tutorial">Second Tutorial</a></li><li><replace_me_please title="System.Windows.Forms tutorial">System.Windows.Forms tutorial</replace_me_please></li></ul><h3>T</h3>
<a name="chunk-Tutorials"></a>
	  	  <h1 class="firstHeading">Tutorials and examples</h1>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1"><a href="#Short_tutorials_for_writing_example_applications"><span class="tocnumber">2</span> <span class="toctext">Short tutorials for writing example applications</span></a></li>
<li class="toclevel-1"><a href="#Snippets"><span class="tocnumber">3</span> <span class="toctext">Snippets</span></a></li>
<li class="toclevel-1"><a href="#Larger_examples"><span class="tocnumber">4</span> <span class="toctext">Larger examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Sokoban_solver"><span class="tocnumber">4.1</span> <span class="toctext">Sokoban solver</span></a></li>
<li class="toclevel-2"><a href="#Nemerle_Course_programs"><span class="tocnumber">4.2</span> <span class="toctext">Nemerle Course programs</span></a></li>
<li class="toclevel-2"><a href="#ICFP.272004_Programming_Contest_entry"><span class="tocnumber">4.3</span> <span class="toctext">ICFP'2004 Programming Contest entry</span></a></li>
<li class="toclevel-2"><a href="#The_Great_Language_Shootout_Examples"><span class="tocnumber">4.4</span> <span class="toctext">The Great Language Shootout Examples</span></a></li>
<li class="toclevel-2"><a href="#ntrace"><span class="tocnumber">4.5</span> <span class="toctext">ntrace</span></a></li>
<li class="toclevel-2"><a href="#Sioux_HTTP_server"><span class="tocnumber">4.6</span> <span class="toctext">Sioux HTTP server</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#External_projects_created_using_Nemerle"><span class="tocnumber">5</span> <span class="toctext">External projects created using Nemerle</span></a>
<ul>
<li class="toclevel-2"><a href="#RiDL_-_Compiler_tools"><span class="tocnumber">5.1</span> <span class="toctext">RiDL - Compiler tools</span></a></li>
<li class="toclevel-2"><a href="#Speagram"><span class="tocnumber">5.2</span> <span class="toctext">Speagram</span></a></li>
<li class="toclevel-2"><a href="#Asper"><span class="tocnumber">5.3</span> <span class="toctext">Asper</span></a></li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Introduction"></a><h2> Introduction </h2>
<p>This page lists some snippets of Nemerle code you may want to
look at. If you have any examples to be submitted here -- please
edit this page or contact us.
</p>
<a name="Short_tutorials_for_writing_example_applications"></a><h2> Short tutorials for writing example applications </h2>
<p>The tutorials gathered here are meant to be used as an easy introduction to the 
the language, by stepping through the process of writing small applications.
</p>
<ul><li><a href="#chunk-First_Tutorial" title="First Tutorial">Don't Panic! - Nemerle Basics Explained</a> -- a simple tutorial covering basic concepts of the Nemerle language.
</li><li><a href="#chunk-Second_Tutorial" title="Second Tutorial">Hashtables and foreach</a> -- presentation of how type inference makes code cleaner.
</li><li>Building a <a href="#chunk-Gtk_text_editor_%28tutorial%29" title="Gtk text editor (tutorial)">text editor using GTK#</a>.
</li><li><a href="#chunk-System.Windows.Forms_tutorial" title="System.Windows.Forms tutorial">System.Windows.Forms tutorial</a>
</li><li><a href="#chunk-Macros_tutorial" title="Macros tutorial">Macros tutorial</a> -- the basics of meta-programming in Nemerle.
</li><li>Using <a href="#chunk-ASP.NET_%28tutorial%29" title="ASP.NET (tutorial)">ASP.NET</a> with Nemerle.
</li><li><a href="#chunk-Remoting_%28tutorial%29" title="Remoting (tutorial)">Remoting</a> -- presents a technique of accessing remote objects on the server.
</li><li><a href="#chunk-PInvoke_%28tutorial%29" title="PInvoke (tutorial)">PInvoking</a> -- gives insight on how to use native (unmanaged) libraries from Nemerle.
</li></ul>
<p>There is also <a href="http://wiki.nemerle.org/Grokking_Nemerle" title="Grokking Nemerle">Grokking Nemerle</a> -- a "book" covering most of the language.
</p>
<a name="Snippets"></a><h2> Snippets </h2>
<p>You can find various examples of Nemerle code in <a href="http://nemerle.org/svn/nemerle/trunk/snippets/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/">snippets</a>
directory in Nemerle source tree. You are welcomed to transform them into tutorials. Examples include:
</p>
<ul><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/lcs.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/lcs.n">lcs.n</a> -- short program computing the longest common substring
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/sql.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sql.n">sql.n</a> -- an example of database connectivity using Nemerle macros
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/suffix.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/suffix.n">suffix.n</a> -- suffix trees
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/ncc/testsuite/positive/form.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/ncc/testsuite/positive/form.n">form.n</a> -- a Windows.Forms example
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/myPoll.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/myPoll.n">myPoll.n</a> -- an example of a CGI application connecting to a PostgreSQL database
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/power-race.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/power-race.n">power-race.n</a> -- a ncurses-based "game". <a href="http://nemerle.org/images/power-race.png" class="external text" title="http://nemerle.org/images/power-race.png">Screenshot</a>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/boyer-moore.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/boyer-moore.n">boyer-moore.n</a> -- a Boyer-Moore algorithm
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/knuth-morris-pratt.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/knuth-morris-pratt.n">knuth-morris-pratt.n</a> -- a Knuth-Morris-Pratt algorithm
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/nondec-subseq.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/nondec-subseq.n">nondec-subseq.n</a> -- the longest non-decreasing subsequence
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/rachunki.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/rachunki.n">rachunki.n</a> -- a billing generator for a conference
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/shift-or.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/shift-or.n">shift-or.n</a> -- a shift-or text searching algorithm
</li></ul>
<p>These are also bundled with the source distribution.
</p>
<a name="Larger_examples"></a><h2> Larger examples </h2>
<p>There are also several more advanced examples there:
</p>
<a name="Sokoban_solver"></a><h3> Sokoban solver </h3>
<p><a href="http://nemerle.org/svn/nemerle/trunk/snippets/sokoban/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sokoban/">Sokoban</a> -- Sokoban solver by Bartosz Podlejski
</p>
<a name="Nemerle_Course_programs"></a><h3> Nemerle Course programs </h3>
<p>Examples done by students during the Nemerle course at the CS Institute in the Wroclaw University.
</p>
<ul><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/ERA-SMS-Sender" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/ERA-SMS-Sender">ERA-SMS-Sender</a> -- allows sending an SMS to a Polish GSM provider ERA (uses a POP3 client). By <b>Adrian Macal</b> <i>mel_on0 at o2 dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/backup-tool.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/backup-tool.n">backup-tool.n</a> -- a program for performing backups, using simple scripts. By <b>Ryszard Trojnacki</b> <i>rysiek at menel dot com</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/freedb.org-client/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/freedb.org-client/">freedb.org client</a> -- a simple program to download information from <a href="http://freedb.org/" class="external text" title="http://freedb.org/">freedb.org</a> database for an audio CD currently in the drive under Linux. By <b>Wojtek Knapik</b> <i>d at hell dot art dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/swf-calculator.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/swf-calculator.n">swf-calculator.n</a> -- a simple calculator using System.Windows.Forms. By <b>Marek Czajka</b> <i>marek_czajka at wp dot pl</i>.
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/huffman/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/huffman/">huffman</a> -- huffman compression and decompression. By <b>Ania Dwojak</b> <i>andzia200 at wp dot pl</i>. 
</li><li><a href="http://nemerle.org/svn/nemerle/trunk/snippets/course/getmxbyname.n" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/course/getmxbyname.n">getmxbyname.n</a> -- a class to find out the MX record for a domain. By <b>Marcin Skórzewski</b> <i>pirol at o2 dot pl</i>.
</li></ul>
<a name="ICFP.272004_Programming_Contest_entry"></a><h3> ICFP'2004 Programming Contest entry </h3>
<p>In June 2004 there was a <a href="http://www.cis.upenn.edu/proj/plclub/contest/ants.html" class="external text" title="http://www.cis.upenn.edu/proj/plclub/contest/ants.html">contest</a> to create finite state automata controlling the ants. Our entry is now available <a href="http://nemerle.org/svn/nemerle/trunk/snippets/ants-icfp2004/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/ants-icfp2004/">here</a>.
</p><p>This year's contest page of our team is located here <a href="http://wiki.nemerle.org/ICFPC2005" title="ICFPC2005">ICFPC2005</a>.
</p>
<a name="The_Great_Language_Shootout_Examples"></a><h3> The Great Language Shootout Examples </h3>
<p><a href="http://nemerle.org/svn/nemerle/trunk/snippets/shootout/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/shootout/">These</a> are the few examples ported from the <a href="http://dada.perl.it/shootout/" class="external text" title="http://dada.perl.it/shootout/">Win32 Computer Language Shootout</a>.
We didn't submit them yet, looking for volunteers to port more. When we
have enough examples, we will also send them to the recently linked <a href="http://shootout.alioth.debian.org/" class="external text" title="http://shootout.alioth.debian.org/">renewed shootout</a>.
</p>
<a name="ntrace"></a><h3> ntrace </h3>
<p>This <a href="http://nemerle.org/svn/nemerle/trunk/snippets/ntrace/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/ntrace/">simple program</a> will trace memory leaks in programs written in C. By Jacek Śliwerski.
</p>
<a name="Sioux_HTTP_server"></a><h3> Sioux HTTP server </h3>
<p>A <a href="http://nemerle.org/svn/nemerle/trunk/snippets/sioux/" class="external text" title="http://nemerle.org/svn/nemerle/trunk/snippets/sioux/">simplistic HTTP server</a>.
The main idea behind it is to serve web applications written in
Nemerle. It already served as a subscription server for the XVIII-th
FIT (a local conference) and later for the <a href="http://csl04.ii.uni.wroc.pl/" class="external text" title="http://csl04.ii.uni.wroc.pl/">CSL 2004</a>.
</p>
<a name="External_projects_created_using_Nemerle"></a><h2> External projects created using Nemerle </h2>
<a name="RiDL_-_Compiler_tools"></a><h3> RiDL - Compiler tools </h3>
<p><a href="http://sourceforge.net/projects/ridl/" class="external text" title="http://sourceforge.net/projects/ridl/">RiDL</a>
is a set of tools to simplify building compilers using Nemerle. It
includes a lexical analyzer generator and a parser generator.
</p><p>It is created by <a href="http://sourceforge.net/users/samanpa/" class="external text" title="http://sourceforge.net/users/samanpa/">Kojo Adams</a> and uses <a href="http://sourceforge.net/softwaremap/trove_list.php?form_cat=187" class="external text" title="http://sourceforge.net/softwaremap/trove list.php?form cat=187">BSD Licence</a>.
</p>
<a name="Speagram"></a><h3> Speagram </h3>
<p><a href="http://www.speagram.org/index.html" class="external text" title="http://www.speagram.org/index.html">Speagram</a> is an eager purely functional language with a strong type system and unusual syntax resembling natural language.
</p>
<a name="Asper"></a><h3> Asper </h3>
<p><a href="https://opensvn.csie.org/traccgi/asper/trac.cgi" class="external text" title="https://opensvn.csie.org/traccgi/asper/trac.cgi">Asper</a> is a text editor and IDE for Nemerle written in Nemerle.
</p></body></html>